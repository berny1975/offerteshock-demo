<!DOCTYPE html>

<html lang="it">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,viewport-fit=cover" name="viewport"/>
<title>Offerteshock.it ‚Äî Offerte, Guide, Blog e Coupon (SPA singolo file)</title>
<meta content="Offerteshock: offerte verificate, confronto prezzi, guide e blog. Preferiti, login/registrati in modale, ricerca con suggerimenti, burger popover, barra migliori offerte." name="description"/>
<link crossorigin="" href="https://images.unsplash.com" rel="preconnect"/>
<link rel="stylesheet" href="./assets/styles.css"/>
</head>
<body>
<header class="fullbleed">
<div class="h-inner" id="hInner">
<div class="brand">
<button aria-label="Menu" class="burger" id="btnBurger" title="Menu">‚ò∞</button>
<a href="index.html" class="home-link"><svg fill="none" viewbox="0 0 24 24"><path d="M4 7.5C4 6.12 5.12 5 6.5 5h3A2.5 2.5 0 0 1 12 7.5v9A2.5 2.5 0 0 1 9.5 19h-3A2.5 2.5 0 0 1 4 16.5v-9Z" fill="#22c55e"></path><path d="M12 7.5C12 6.12 13.12 5 14.5 5h3A2.5 2.5 0 0 1 20 7.5v1A2.5 2.5 0 0 1 17.5 11h-3A2.5 2.5 0 0 1 12 8.5v-1Z" fill="#3b82f6"></path></svg>
<span>Offerteshock.it</span></a>
</div>
<div id="authDock">
<div class="fav-pill" id="favToggle" title="Preferiti">‚ù§Ô∏è <span class="count" id="favCount">0</span></div>
<button class="btn xs" id="btnLogin">Login</button>
<button class="btn primary xs" id="btnRegister">Registrati</button>
<button class="btn xs" id="btnLogout" style="display:none">Logout</button>
</div>
<div class="search" role="search">
<div class="ctrl cat">
<span class="label" id="labCat">Categorie:</span>
<span class="select small"><select aria-labelledby="labCat" id="catSelect">
<option value="all">Tutte</option>
<option value="elettronica">Elettronica &amp; Tech</option>
<option value="casa_cucina">Casa e Cucina</option>
<option value="animali">Prodotti per Animali</option>
<option value="bellezza">Bellezza &amp; Cura Persona</option>
<option value="fai_da_te">Fai da Te e Giardinaggio</option>
<option value="infanzia">Prodotti per l'Infanzia</option>
</select></span>
</div>
<div class="searchbar">
<input aria-label="Cerca" autocomplete="off" class="search-in" id="q" placeholder="Cerca brand, modello, categoria‚Ä¶" type="search"/>
<button aria-label="Esegui ricerca" class="btn ghost btn-search" id="btnSearch">Cerca</button>
</div>

</div>
</div>
</header>
<!-- Burger Popover + scrim -->
<div aria-hidden="true" class="pop-scrim" id="popScrim"></div>
<div aria-hidden="true" class="pop" id="popMenu" role="menu">
<nav class="pop-nav">
<a class="pop-item" href="index.html">Home</a>
<a class="pop-item" href="about.html">Chi Siamo</a>
<a class="pop-item" href="guides.html">Guide</a>
<a class="pop-item" href="blog.html">Blog</a>
<a class="pop-item" href="favs.html">Preferiti</a>
<a class="pop-item" href="settings.html">Impostazioni</a>
<a class="pop-item" href="privacy.html">Privacy</a>
<a class="pop-item" href="cookie.html">Cookie</a>
<a class="pop-item" href="termini.html">Termini</a>
<a class="pop-item" href="contatti.html">Contatti</a>
</nav>
</div>
<!-- Barra migliori offerte (ticker) -->
<main class="container">

<!-- Demo Features Banner -->
<div class="demo-banner">
  <div class="demo-content">
    <h2>üöÄ Demo OfferteSHOCK - Tutte le Funzionalit√†</h2>
    <p>Esplora tutte le caratteristiche di questa piattaforma di offerte avanzata:</p>
    <div class="demo-features">
      <span class="demo-tag">‚ö° Offerte Flash in tempo reale</span>
      <span class="demo-tag">üíé Prodotti trending</span>
      <span class="demo-tag">üéØ Filtri intelligenti</span>
      <span class="demo-tag">‚ù§Ô∏è Sistema preferiti</span>
      <span class="demo-tag">üìä Storico prezzi</span>
      <span class="demo-tag">üîÑ Comparazione store</span>
      <span class="demo-tag">üé´ Gestione coupon</span>
      <span class="demo-tag">üì± Design responsivo</span>
    </div>
  </div>
</div>

<div class="section-head">
<div class="section-title">Offerta in evidenza</div>
</div>
<section class="hero" id="hero"></section>
<div class="section-head">
<div class="section-title">Top venduti</div>
</div>
<section class="grid" id="tops"></section>
<div class="section-head">
<div class="section-title">Tutte le offerte <span id="resultsCount">0 risultati</span></div>
</div>
<section class="grid" id="grid"></section>
<div class="footer" style="opacity:.8;margin:28px 0">
<p>Demo offline con il tuo tema. Sostituisci i link con i tuoi deeplink affiliati. In qualit√† di Affiliato Amazon, potrei ricevere un compenso dagli acquisti idonei.</p>
<p><a href="privacy.html">Privacy</a> ¬∑ <a href="cookie.html">Cookie</a> ¬∑ <a href="termini.html">Termini</a></p>
</div>

</main>
<!-- Modali -->



<section class="modal" id="m-favs"><div class="dialog"><button class="close" data-close="">√ó</button><h3>I tuoi preferiti</h3><div class="grid" id="favs"></div></div></section>

<section class="modal" id="m-login"><div class="dialog"><button class="close" data-close="">√ó</button><h3>Accedi</h3><div class="form"><label>Email<br/><input id="loginEmail" type="email"/></label><br/><label>Password<br/><input id="loginPwd" type="password"/></label><br/><button class="btn primary" id="doLogin">Login</button></div></div></section>
<section class="modal" id="m-register"><div class="dialog"><button class="close" data-close="">√ó</button><h3>Crea account</h3><div class="form"><label>Nome<br/><input id="regName"/></label><br/><label>Email<br/><input id="regEmail" type="email"/></label><br/><label>Password<br/><input id="regPwd" type="password"/></label><br/><button class="btn primary" id="doRegister">Registrati</button></div></div></section>




<script>
/* ========= Utils ========= */
const qs = s => document.querySelector(s);
const qsa = s => [...document.querySelectorAll(s)];
const ce = (t,cls) => Object.assign(document.createElement(t), cls?{className:cls}:{});
const fmtEur = n => new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(n);

/* ========= Categorie ========= */
const CAT_LABELS = {
  all: "Tutte",
  elettronica: "Elettronica & Tech", 
  casa_cucina: "Casa e Cucina",
  animali: "Prodotti per Animali",
  bellezza: "Bellezza & Cura Persona",
  fai_da_te: "Fai da Te e Giardinaggio",
  infanzia: "Prodotti per l'Infanzia"
};
const catLabel = k => CAT_LABELS[k] || k;

/* ========= Demo data ========= */
const AMAZON_TAG="YOUR_TAG-21";
const DEALS=[
  // üî• FLASH DEALS - Limited Time  
  { id:"flash1", title:"üî• FLASH: iPhone 15 128GB", desc:"Sconto lampo! Solo per oggi. Ultimi pezzi disponibili in tutti i colori.", rating:4.8, reviews:12450, cat:"elettronica", store:"Amazon", merchant:"amazon", priceNow:699, priceWas:979, discount:29, coupon:"FLASH20", image:"https://images.unsplash.com/photo-1592750475338-74b7b21085ab?q=80&w=1200&auto=format&fit=crop", history:[979,949,899,799,699], addedAt:"2025-01-15", links:{ amazon:"https://www.amazon.it/dp/B0FLASHIPHONE" }, gallery:['https://images.unsplash.com/photo-1592750475338-74b7b21085ab?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop'], pros:['Fotocamera eccezionale','USB-C finalmente','Prestazioni top','Autonomia migliorata'], cons:['Prezzo ancora alto','Ricarica lenta inclusa','Niente adattatore'], specs:[['Storage','128 GB'],['Display','6.1" OLED'],['Camera','48 MP'],['Colori','5 disponibili']], longDesc:`Il prezzo pi√π basso di sempre per iPhone 15! Perfetto upgrade da iPhone 12/13. La fotocamera fa la differenza, USB-C √® una comodit√†. Solo oggi a questo prezzo.` },
  
  { id:"flash2", title:"üî• FLASH: PlayStation 5 + 2 Giochi", desc:"Console + Spider-Man 2 + God of War. Bundle esclusivo, solo 50 pezzi!", rating:4.9, reviews:8920, cat:"elettronica", store:"GameStop", merchant:"awin", priceNow:449, priceWas:649, discount:31, coupon:null, image:"https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?q=80&w=1200&auto=format&fit=crop", history:[649,599,549,499,449], addedAt:"2025-01-15", links:{ awin:"https://www.awin1.com/cread.php?awinmid=333&awinaffid=444" }, gallery:['https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?q=80&w=1200&auto=format&fit=crop'], pros:['Bundle con 2 giochi top','Disponibilit√† garantita','Spedizione rapida'], cons:['Pochi pezzi disponibili','Bundle fisso, non personalizzabile'], specs:[['Include','Console + 2 giochi'],['Memoria','825 GB SSD'],['Garanzia','2 anni'],['Disponibilit√†','50 pezzi']], longDesc:`Offerta irripetibile! PS5 finalmente disponibile con 2 dei giochi pi√π richiesti. A questo prezzo vola via.` },

  { id:"trending1", title:"üíé AirPods Pro 2 con USB-C", desc:"Cancellazione attiva del rumore, audio spaziale personalizzato. Custodia MagSafe.", rating:4.7, reviews:5890, cat:"elettronica", store:"Amazon", merchant:"amazon", priceNow:199, priceWas:279, discount:29, coupon:"AUDIO15", image:"https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?q=80&w=1200&auto=format&fit=crop", history:[279,259,239,219,199], addedAt:"2025-01-14", links:{ amazon:"https://www.amazon.it/dp/B0AIRPODS2" }, gallery:['https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?q=80&w=1200&auto=format&fit=crop'], pros:['Cancellazione rumore eccellente','Autonomia migliorata','USB-C pratico'], cons:['Prezzo elevato','Solo per iPhone ottimale'], specs:[['Autonomia','6h + 24h custodia'],['Connessione','USB-C'],['Resistenza','IPX4'],['Chip','H2']], longDesc:`Gli AirPods Pro 2 sono un upgrade sensato dai precedenti. La cancellazione del rumore √® top di gamma, l'audio spaziale fa la differenza nei film.` },

  { id:"trending2", title:"üíé Dyson V15 Detect Absolute", desc:"Aspirapolvere senza filo con laser per polvere invisibile. Autonomia 60 min.", rating:4.6, reviews:3240, cat:"casa_cucina", store:"Unieuro", merchant:"awin", priceNow:449, priceWas:649, discount:31, coupon:null, image:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?q=80&w=1200&auto=format&fit=crop", history:[649,599,549,499,449], addedAt:"2025-01-13", links:{ awin:"https://www.awin1.com/cread.php?awinmid=555&awinaffid=666" }, gallery:['https://images.unsplash.com/photo-1558618666-fcd25c85cd64?q=80&w=1200&auto=format&fit=crop'], pros:['Laser per vedere la polvere','Potenza eccellente','Design ergonomico','Accessori completi'], cons:['Prezzo elevato','Rumoroso al massimo','Autonomia variabile'], specs:[['Autonomia','60 min'],['Potenza','230 W'],['Capacit√†','0.77 L'],['Accessori','7 inclusi']], longDesc:`Il V15 Detect √® un investimento: costoso ma efficace. Il laser verde rivela polvere che non vedresti mai, la potenza √® costante. Per case grandi √® perfetto.` },

  // Enhanced existing deals
  { id:"d1", title:"Friggitrice ad Aria 5.5L", desc:"Cestello antiaderente, 8 programmi, facile da pulire. Ideale per porzioni familiari con minore olio.", rating:4.6, reviews:3560, cat:"casa_cucina", store:"Amazon", merchant:"amazon", priceNow:89, priceWas:139, discount:36, coupon:"AIR10", image:"https://images.unsplash.com/photo-1606756790138-261c7d3113b9?q=80&w=1200&auto=format&fit=crop", history:[139,129,119,99,89], addedAt:"2025-08-05", links:{ amazon:"https://www.amazon.it/dp/B08XYZXYZ" , gallery:['https://images.unsplash.com/photo-1606756790138-261c7d3113b9?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1543352634-8730a9b43ae4?q=80&w=1200&auto=format&fit=crop'], pros:['Cuoce in modo uniforme','Cestello grande per famiglia','Facile da pulire','Programmi essenziali, non troppi'], cons:['Ingombro sul piano cucina','Nessuna app/ricette integrate','Rumore ventola udibile a piena potenza'], specs:[['Capienza','5.5 L'],['Potenza','1700 W'],['Lavastoviglie','Cestello s√¨'],['Programmi','8'],['Garanzia','2 anni']], longDesc:`Abbiamo cucinato patate, pollo e verdure per pi√π giorni: la resa √® stata costante, con doratura uniforme senza odori forti. Non √® un modello ‚Äúsmart‚Äù: per molti √® un pro (meno complessit√†), per chi vuole app/appunti √® un contro. Dopo 2 settimane di uso, il rivestimento √® ancora perfetto. Consigliata a chi vuole qualit√† senza spendere troppo.`} },
  { id:"d2", title:"Cibo Secco Premium per Cani 12kg", desc:"Ricco di proteine con ingredienti dichiarati, senza coloranti. Sacco richiudibile anti-odore.", rating:4.7, reviews:1420, cat:"animali", store:"Zooplus", merchant:"awin", priceNow:39, priceWas:59, discount:34, coupon:"DOG5", image:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop", history:[59,55,49,45,39], addedAt:"2025-08-06", links:{ awin:"https://www.awin1.com/cread.php?awinmid=222&awinaffid=333" , gallery:['https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1612539927811-2b18a6c41f5e?q=80&w=1200&auto=format&fit=crop'], pros:['Buona tollerabilit√†','Rapporto qualit√†/prezzo','Sacco richiudibile comodo'], cons:['Crocche non adatte a cani molto piccoli','Nessuna variante grain-free','Odore intenso all‚Äôapertura'], specs:[['Formato','12 kg'],['Proteine','24%'],['Conservazione','Sacco richiudibile'],['Origine','UE']], longDesc:`Provato su due cani (taglia media): feci regolari e pelo lucido dopo 10 giorni. Non √® super premium, ma in promo √® un ottimo compromesso. Se il tuo cane √® sensibile ai cereali, valuta alternative grain-free.`} },
  { id:"d3", title:"Siero Viso Acido Ialuronico 60ml", desc:"Texture leggera, ad assorbimento rapido. Ingredienti essenziali, adatto a tutti i tipi di pelle.", rating:4.4, reviews:2300, cat:"bellezza", store:"Amazon", merchant:"amazon", priceNow:12, priceWas:19, discount:37, coupon:null, image:"https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop", history:[19,17,15,13,12], addedAt:"2025-08-08", links:{ amazon:"https://www.amazon.it/dp/B0AAABBBB" , gallery:['https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1545239351-1141bd82e8a6?q=80&w=1200&auto=format&fit=crop'], pros:['Texture leggera','INCI essenziale','Ottimo sotto il make-up'], cons:['Flacone senza contagocce di qualit√†','Profumo leggero non per tutti'], specs:[['Contenuto','60 ml'],['Attivo','Acido Ialuronico'],['Profumo','Leggero'],['Pelli','Tutte']], longDesc:`Usato mattina e sera per due settimane: pelle pi√π elastica, senza pilling con la crema solare. Non aspettarti miracoli anti-et√†: √® idratazione onesta a prezzo corretto.`} },
  { id:"d4", title:"Trapano Avvitatore 18V con Accessori", desc:"Coppia regolabile, luce LED e set punte incluso. Valigetta rigida per riporre tutto.", rating:4.5, reviews:980, cat:"fai_da_te", store:"Leroy Merlin", merchant:"tradedoubler", priceNow:69, priceWas:99, discount:30, coupon:null, image:"https://images.unsplash.com/photo-1504148455329-4ff0802cfb7e?q=80&w=1200&auto=format&fit=crop", history:[99,92,85,79,69], addedAt:"2025-07-30", links:{ tradedoubler:"https://clk.tradedoubler.com/click?p=333&a=444" , gallery:['https://images.unsplash.com/photo-1504148455329-4ff0802cfb7e?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1511207538754-e855bd8f15a5?q=80&w=1200&auto=format&fit=crop'], pros:['Buona coppia per lavori leggeri','Valigetta con accessori','Luce LED utile in spazi stretti'], cons:['Non adatto a muratura impegnativa','Mandrino con lieve gioco','Batteria singola in confezione base'], specs:[['Voltaggio','18 V'],['Modalit√†','Trapano/Avvitatore'],['Accessori','S√¨'],['Luce','LED']], longDesc:`Perfetto per casa: mensole, piccoli montaggi, riparazioni. Per fori importanti nel cemento serve altro. Il LED fa la differenza in armadi e nicchie.`} },
  { id:"d5", title:"Passeggino Leggero Pieghevole", desc:"Telaio in alluminio, schienale reclinabile e chiusura con una mano. Omologato fino a 15 kg.", rating:4.6, reviews:640, cat:"infanzia", store:"Amazon", merchant:"amazon", priceNow:99, priceWas:159, discount:38, coupon:"BABY10", image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?q=80&w=1200&auto=format&fit=crop", history:[159,149,129,119,99], addedAt:"2025-08-04", links:{ amazon:"https://www.amazon.it/dp/B0CCCCCCC" , gallery:['https://images.unsplash.com/photo-1631049307264-da0ec9d70304?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1595433707802-6b2626ef1c86?q=80&w=1200&auto=format&fit=crop'], pros:['Si chiude con una mano','Molto leggero','Tessuti facili da pulire'], cons:['Cesto sottosedile non enorme','Ruote piccole su sanpietrini','Colori limitati'], specs:[['Peso','6.9 kg'],['Omologazione','fino 15 kg'],['Chiusura','One-hand'],['Accessori','Parapioggia']], longDesc:`Provato su marciapiedi e mezzi pubblici: maneggevole e stabile. Non √® un fuoristrada, ma per citt√† va benissimo. Seduta comoda, cinture rapide.`} },
  { id:"d6", title:"Set Pentole Acciaio 10 pz", desc:"Fondo adatto a induzione, manici isolanti e coperchi in vetro. Lavabile in lavastoviglie.", rating:4.5, reviews:620, cat:"casa_cucina", store:"Amazon", merchant:"amazon", priceNow:99, priceWas:149, discount:34, coupon:null, image:"https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop", history:[149,139,129,119,99], addedAt:"2025-08-01", links:{ amazon:"https://www.amazon.it/dp/B0DDDDEEEE" , gallery:['https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1485968579580-b6d095142e6e?q=80&w=1200&auto=format&fit=crop'], pros:['Fondo a sandwich per induzione','Coperchi in vetro con sfiato','Impilabili e lavabili'], cons:['Manici che scaldano a fiamma alta','Niente scala interna di misure'], specs:[['Pezzi','10'],['Materiale','Acciaio'],['Lavastoviglie','S√¨'],['Compatibilit√†','Induzione']], longDesc:`Qualit√† solida per uso quotidiano. Non antiaderenti: serve un filo d‚Äôolio in pi√π ma durano nel tempo. In promo diventano un best buy.`} },
  { id:"d7", title:"Tosaerba Elettrico 1400W", desc:"Larghezza taglio 32 cm, raccolta 30 L, regolazione altezza in 3 posizioni. Perfetto per giardini piccoli.", rating:4.2, reviews:510, cat:"fai_da_te", store:"Amazon", merchant:"amazon", priceNow:119, priceWas:179, discount:34, coupon:null, image:"https://images.unsplash.com/photo-1523419410227-deebaa99fd0f?q=80&w=1200&auto=format&fit=crop", history:[179,169,149,139,119], addedAt:"2025-07-25", links:{ amazon:"https://www.amazon.it/dp/B0FFFFGGGG" , gallery:['https://images.unsplash.com/photo-1523419410227-deebaa99fd0f?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1562599938-7208977f7baf?q=80&w=1200&auto=format&fit=crop'], pros:['Leggero e facile da spingere','Raccolta sufficiente per 200 m¬≤','Regolazione altezza rapida'], cons:['Cavo da gestire (non √® a batteria)','Rumore nella media','Scocca non metallica'], specs:[['Potenza','1400 W'],['Larghezza taglio','32 cm'],['Cesto','30 L'],['Terreno','fino 250 m¬≤']], longDesc:`Se hai un giardino piccolo/medio fa il suo, senza spese di batterie. Lame sostituibili facili da trovare. Attenzione a cavi e prolunghe di qualit√†.`} },
  { id:"d8", title:"Cuccia Morbida per Gatti L", desc:"Interno in peluche, fondo antiscivolo e cuscino estraibile. Lavabile in lavatrice 30¬∞.", rating:4.5, reviews:880, cat:"animali", store:"Amazon", merchant:"amazon", priceNow:25, priceWas:39, discount:36, coupon:null, image:"https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop", history:[39,35,32,29,25], addedAt:"2025-08-02", links:{ amazon:"https://www.amazon.it/dp/B0HHHHIIII" , gallery:['https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1573865526739-10659fec78a5?q=80&w=1200&auto=format&fit=crop'], pros:['Morbida e avvolgente','Fondo antiscivolo','Cuscino estraibile'], cons:['Taglia L stretta per gatti XXL','Colore chiaro si sporca facilmente'], specs:[['Taglia','L'],['Lavaggio','30¬∞'],['Fondo','Antiscivolo'],['Uso','Interno']], longDesc:`I gatti ci saltano dentro in pochi minuti (testato con 2 mici redattori). Calda, stabile, zero odore chimico al primo uso.`} }
];
const GUIDES=[
  {id:"g1", title:"Come risparmiare davvero online (senza fregature)", excerpt:"Metodo, non fortuna: budget, preferiti e storico prezzi.", body:`
    <p>Risparmiare non √® questione di ‚Äúcolpo di fortuna‚Äù, ma di <b>metodo</b>. La prima regola √® stabilire un <b>budget</b> e rispettarlo: quando vedi un -40% √® facile lasciarsi prendere, ma se quel prezzo ‚Äúpieno‚Äù non esiste mai, lo sconto non √® reale. Per questo su Offerteshock guardiamo lo <b>storico</b> dei prezzi e segnaliamo solo cali che hanno senso.</p>
    <p>Secondo: usa i <b>Preferiti</b>. Aggiungi i prodotti che ti interessano e lascia che sia il sistema ad avvisarti quando scendono davvero. Terzo: i <b>coupon intelligenti</b>. Alcuni si sommano allo sconto in pagina (stack), altri richiedono login al negozio. Vale sempre la pena provare.</p>
    <p>Errori comuni? Comprare ‚Äúperch√© √® in offerta‚Äù, rincorrere modelli vecchi solo per il prezzo, sottovalutare i costi di reso. La nostra <b>checklist</b>: 1) ho davvero bisogno di questo? 2) √® il <i>prezzo pi√π basso degli ultimi mesi</i>? 3) la qualit√† √® coerente con l‚Äôuso che ne far√≤? Se le risposte sono s√¨, √® un buon affare.</p>`},
  {id:"g2", title:"Guida pratica all‚Äôacquisto su Amazon con affiliazione", excerpt:"Prezzo uguale per te, piccola commissione per noi (trasparente).", body:`
    <p>Quando clicchi un nostro link affiliato verso Amazon, <b>il prezzo per te non cambia</b>. Se concludi un acquisto idoneo, Amazon riconosce una piccola commissione a Offerteshock: √® il modo con cui manteniamo contenuti gratuiti e indipendenti.</p>
    <p>Noi selezioniamo le offerte con gli stessi criteri che useremmo per noi: niente ‚Äúspinte‚Äù sponsor, niente favoritismi. Se un prodotto non ci convince, lo scriviamo. In pagina trovi sempre <b>pro e contro</b>, alternative e un‚Äôindicazione onesta su chi dovrebbe comprarlo e chi no.</p>
    <p>Consiglio pratico: aggiungi ai Preferiti i modelli che ti interessano e aspetta un calo significativo. Spesso basta <b>qualche giorno</b> per vedere -10/-20% in periodi strategici (fine mese, weekend lunghi, eventi). Comprare bene √® una maratona, non uno sprint.</p>`},
  {id:"g3", title:"Friggitrice ad aria: come scegliere quella giusta", excerpt:"Capienza reale, watt, programmi utili e pulizia.", body:`
    <p>La domanda numero uno: <b>capienza</b>. Per 1‚Äì2 persone bastano 4‚Äì5 L; famiglie 3‚Äì4 persone meglio 5,5‚Äì7 L; oltre, considera i modelli ‚Äúduo‚Äù con doppio cestello. I <b>watt</b> contano per tempi rapidi e doratura uniforme (1.500‚Äì1.800 W sono uno sweet spot).</p>
    <p>Programmi? Meglio pochi ma utili: patatine, pollo, verdure coprono il 90% dei casi. Valuta materiali (cestello antiaderente resistente, parti lavabili in lavastoviglie), <b>rumorosit√†</b> e ingombro sul piano cucina. Diffida delle promesse miracolose: la differenza reale la fanno uniformit√† di cottura e facilit√† di pulizia.</p>
    <p>Pro tip: se mangi spesso per pi√π persone, il <b>doppio cestello</b> evita ‚Äúondate‚Äù di cottura e ti fa davvero risparmiare tempo.</p>`},
  {id:"g4", title:"Cura del prato in 30 minuti a settimana", excerpt:"Routine semplice, attrezzi giusti, stagionalit√†.", body:`
    <p>Per un prato in ordine non serve passare i weekend al tagliaerba. Bastano <b>30 minuti</b> a settimana con una routine costante: taglio leggero (mai pi√π di 1/3 dell‚Äôaltezza), rifinitura dei bordi e controllo rapido di erbacce e zone ingiallite. In estate alza l‚Äôaltezza di taglio (5‚Äì6 cm) per proteggere l‚Äôerba dal caldo.</p>
    <p>Attrezzi minimi: rasaerba affidabile, rifilabordi, rastrello. Se innaffi, fallo al mattino presto 2‚Äì3 volte a settimana, evitando ristagni. In primavera valuta un <b>carotaggio</b> leggero per arieggiare e in autunno una concimazione ‚Äúlenta‚Äù per preparare l‚Äôinverno.</p>
    <p>Ricorda: regolarit√† > intensit√†. Poco e spesso vince sempre.</p>`},
  {id:"g5", title:"Beauty routine semplice (3 prodotti, zero sprechi)", excerpt:"Detersione, siero, crema con SPF. Fine.", body:`
    <p>La miglior routine √® quella che <b>riesci a mantenere</b>. Partiamo da tre pilastri: detersione delicata, siero mirato (es. ialuronico per idratazione) e crema con <b>SPF</b> la mattina. Per pelli grasse aggiungi un attivo come niacinamide; per quelle secche scegli texture pi√π ricche. Leggi INCI con buon senso: pochi ingredienti chiari valgono pi√π di buzzword rumorose.</p>
    <p>Evita di introdurre cinque novit√† insieme: testa un prodotto per volta e fai un <b>patch test</b> se hai pelle reattiva. Ricorda che costoso non significa sempre migliore: presta attenzione a formulazione, confezione e esperienza d‚Äôuso.</p>`},
  {id:"g6", title:"Passeggino: cosa conta davvero", excerpt:"Peso, chiusura, ruote e certificazioni.", body:`
    <p>Se vivi in citt√† (scale, mezzi pubblici), il <b>peso</b> e la <b>chiusura con una mano</b> fanno la differenza. Le ruote grandi aiutano su sanpietrini o sterrato leggero; una cappottina profonda con protezione UV √® pi√π utile di tanti accessori ‚Äúgadget‚Äù.</p>
    <p>Valuta <b>reclinazione</b> e compatibilit√† con navicella/ovetto. Verifica le certificazioni e i limiti di peso, e pensa alla <b>pulizia</b>: rivestimenti sfoderabili ti salvano tempo (e nervi). Accessori da considerare: parapioggia, coprigambe, borsa capiente. Non inseguire il top di gamma: meglio un buon compromesso che userai davvero.</p>`}
];
const POSTS=[
  {id:"p1", title:"Top 10 offerte Casa & Cucina di oggi", date:"2025-08-11", body:`
    <p>Ogni giorno selezioniamo a mano le offerte ‚Äúche prenderemmo anche noi‚Äù. Niente finti sconti, niente corse al ribasso su prodotti scarsi. Guardiamo lo <b>storico</b> dei prezzi, il rapporto qualit√†/prezzo e l‚Äôutilit√† nella vita di tutti i giorni. Se un set di pentole ha bordi sottili che deformano, lo scartiamo; se un robot pulisce bene ma si incastra sui tappeti, lo diciamo. La lista cambia spesso: salva tra i <b>Preferiti</b> i prodotti che ti interessano e lascia che sia il prezzo a venire da te.</p>`},
  {id:"p2", title:"Animali: risparmiare senza rinunciare alla qualit√†", date:"2025-08-11", body:`
    <p>Con cani e gatti i soldi volano, ma si pu√≤ risparmiare con buon senso. Controlla <b>ingredienti</b> e formato: i sacchi grandi costano meno al kg, ma solo se li consumi prima che perdano freschezza. Occhio alle promo ricorrenti su cibo premium: spesso tornano a fine mese. Valuta abbonamenti flessibili (si sospendono quando vuoi) e usa i <b>Preferiti</b> per tracciare il tuo brand preferito: quando scende, ti avvisiamo noi.</p>`},
  {id:"p3", title:"Bellezza: pochi prodotti, risultati concreti", date:"2025-08-11", body:`
    <p>La routine perfetta non esiste; esiste quella che funziona per te. Noi puntiamo su pochi prodotti ben formulati: detergente delicato, siero mirato, crema con SPF. Evitiamo pack esagerati e promesse lunaresche. Se un prodotto √® ottimo ma caro, suggeriamo <b>alternative equivalenti</b>. E se costa poco ma funziona, lo diciamo a gran voce. L‚Äôobiettivo non √® riempire il bagno, ma far rendere il budget.</p>`},
  {id:"p4", title:"Fai da te & Giardino: strumenti che durano", date:"2025-08-11", body:`
    <p>Comprare male √® comprare due volte. Preferiamo attrezzi con <b>ricambi disponibili</b>, assistenza decente e un po‚Äô di sovradimensionamento: un trapano che non si surriscalda e un rasaerba che non si ferma a met√† prato sono soldi risparmiati. Nei nostri consigli trovi pro e contro chiari, perch√© ogni casa e ogni mano sono diverse: meglio scegliere bene che inseguire la promo del giorno.</p>`},
  {id:"p5", title:"Infanzia: sicurezza e praticit√† prima di tutto", date:"2025-08-11", body:`
    <p>Quando si parla di bambini, la priorit√† √® doppia: <b>sicurezza</b> e praticit√†. Per i passeggini contano ruote, telaio e facilit√† di chiusura; per seggiolini auto e navicelle informati sempre sulle norme aggiornate e sulle compatibilit√† con la tua auto. Noi selezioniamo prodotti che semplificano la vita: lavabili, robusti, ben progettati. E se il colore non √® quello ‚Äúdi moda‚Äù, pazienza: il comfort vince.</p>`}
];

/* ========= Stato ========= */
const FAV_KEY='os_fav_v11'; let FAVS=new Set(JSON.parse(localStorage.getItem(FAV_KEY)||'[]'));
let QUERY=''; let SORT='best'; let CAT='all';

/* ========= Helpers UI ========= */
function stars(n){ const full=Math.floor(n); const half=(n-full)>=0.5 ? 1 : 0; return '‚òÖ'.repeat(full)+ (half?'¬Ω':'') + '<span style="opacity:.4">'+ '‚òÖ'.repeat(5-full-half)+'</span>'; }
function spark(history){
  const w=260,h=32,p=6,min=Math.min(...history),max=Math.max(...history);
  const sx=i=>p+(i*(w-2*p)/(history.length-1)), sy=v=>p+(h-2*p)-(((v-min)/(max-min||1))*(h-2*p));
  let d=""; history.forEach((v,i)=> d+=(i?'L':'M')+sx(i)+' '+sy(v)+' ');
  const last=history.at(-1), first=history[0], col= last<first?'#22c55e':'#eab308';
  return `<svg width="${w}" height="${h}" role="img" aria-label="Andamento prezzo"><path d="${d}" fill="none" stroke="${col}" stroke-width="2"/></svg>`;
}
function badge(o){
  if(o.id && o.id.startsWith('flash')) return `<div class="badge flash">‚ö° FLASH DEAL</div>`;
  if(o.id && o.id.startsWith('trending')) return `<div class="badge trending">üíé TRENDING</div>`;
  if(o.discount>=60) return `<div class="badge errore">‚ö° Probabile errore di prezzo</div>`;
  if(o.discount>=45) return `<div class="badge bomba">üî• Offerta bomba</div>`;
  if(o.priceWas && o.priceNow && o.priceNow<o.priceWas) return `<div class="badge">Risparmia ${fmtEur(o.priceWas - o.priceNow)}</div>`;
  return '';
}
function aff(url, merchant, id){
  const sub = "DEMO_"+id;
  try{
    if(merchant==='amazon'){ const u=new URL(url); if(!u.searchParams.get('tag')) u.searchParams.set('tag', AMAZON_TAG); u.searchParams.set('ascsubtag', sub); return u.toString(); }
    if(merchant==='awin'){ return url + (url.includes('?')?'&':'?') + 'clickref=' + encodeURIComponent(sub); }
    if(merchant==='tradedoubler'){ return url + (url.includes('?')?'&':'?') + 'epi=' + encodeURIComponent(sub); }
  }catch(e){}
  return url;
}
function card(o){
  const fav=FAVS.has(o.id);
  const url = Object.values(o.links)[0] || '#';
  return `<article class="card" data-id="${o.id}">
    ${badge(o)}
    <button class="fav-btn ${fav?'active':''}" data-fav="${o.id}" aria-pressed="${fav}" aria-label="Aggiungi ai preferiti">‚ù§Ô∏è</button>
    <img src="${o.image}" alt="${o.title}">
    <div class="content">
      <div class="title">${o.title}</div>${o.desc?`<p class="desc">${o.desc}</p>`:""}
      <div class="stars">${stars(o.rating)} <span style="opacity:.7">(${o.reviews.toLocaleString('it-IT')})</span></div>
      <div class="price"><span class="now">${fmtEur(o.priceNow)}</span> <span class="was">${fmtEur(o.priceWas)}</span> <span class="discount">-${o.discount}%</span></div>
      <div class="tags"><span class="tag">Store: ${o.store}</span><span class="tag">Cat: ${catLabel(o.cat)}</span></div>
      ${spark(o.history)}
      <div class="cta">
        <a class="btn primary" href="${aff(url, o.merchant, o.id)}" target="_blank" rel="nofollow sponsored">Vai all‚Äôofferta</a>
        <button class="btn" data-detail="${o.id}">Dettagli</button>
      </div>
      <div class="cta">
        ${o.coupon?`<span class="coupon-chip">Coupon <code>${o.coupon}</code> <button class="btn btn-copy" data-copy="${o.coupon}">Copia</button><span class="copy-ok">‚úì Copiato</span></span>`:''}
        <button class="btn" data-share="${o.id}">Condividi</button>
      </div>
    </div>
  </article>`;
}

/* ========= Ordinamento e filtri ========= */
const cmp = {
  best: (a,b)=> (b.discount + b.rating/5) - (a.discount + a.rating/5),
  discount_desc: (a,b)=> b.discount - a.discount,
  price_asc: (a,b)=> a.priceNow - b.priceNow,
  price_desc:(a,b)=> b.priceNow - a.priceNow,
  reviews_desc:(a,b)=> b.reviews - a.reviews,
  new_desc:(a,b)=> new Date(b.addedAt) - new Date(a.addedAt),
};
function filtered(){
  let res = DEALS.slice();
  if(CAT!=='all') res = res.filter(o => o.cat===CAT);
  if(QUERY){ const t=QUERY.toLowerCase(); res = res.filter(o=> o.title.toLowerCase().includes(t)); }
  res.sort(cmp[SORT] || cmp.best);
  return res;
}
function syncControls(){
  const sc = qs('#sortCompact'), cat = qs('#catSelect');
  if(sc) sc.value = SORT;
  if(cat) cat.value = CAT;
}

/* ========= Render ========= */
function render(){
  const list = filtered();
  qs('#hero').innerHTML = list.slice(0,2).map(card).join('');
  qs('#tops').innerHTML = list.slice(2,5).map(card).join('');
  qs('#grid').innerHTML = list.map(card).join('');
  qs('#resultsCount').textContent = `${list.length} risultati`;
  qsa('.fav-btn').forEach(b => { const id=b.dataset.fav; b.classList.toggle('active', FAVS.has(id)); b.setAttribute('aria-pressed', b.classList.contains('active')); });
  buildTicker(list);
  syncControls();
}
function buildTicker(list){
  const best = list.slice().sort(cmp.discount_desc).slice(0,8);
  const items = best.map(o=> `<span class="tick">üî• <b>-${o.discount}%</b> ${o.title} ¬∑ <a href="${aff(Object.values(o.links)[0]||'#', o.merchant, o.id)}" target="_blank" rel="nofollow sponsored">Vai</a></span>`).join('');
  const html = items + items;
  const track = qs('#tickerTrack');
  if(track){ track.innerHTML = html; }
}

/* ========= Interazioni card ========= */
document.addEventListener('click', (e)=>{
  const fav = e.target.closest('.fav-btn');
  if(fav){
    const id = fav.dataset.fav;
    if(FAVS.has(id)) FAVS.delete(id); else FAVS.add(id);
    localStorage.setItem(FAV_KEY, JSON.stringify([...FAVS]));
    fav.classList.toggle('active'); fav.setAttribute('aria-pressed', fav.classList.contains('active'));
    qs('#favCount').textContent = FAVS.size;
    return;
  }
  const cp = e.target.closest('[data-copy]');
  if(cp){
    const code = cp.getAttribute('data-copy');
    navigator.clipboard.writeText(code).then(()=>{
      const ok = cp.parentElement.querySelector('.copy-ok'); if(ok){ ok.classList.add('show'); setTimeout(()=>ok.classList.remove('show'), 1200); }
    });
    return;
  }
  const det = e.target.closest('[data-detail]');
  if(det){
    const o = DEALS.find(x=> x.id===det.getAttribute('data-detail'));
    if(o) openArticle(`<h3>${o.title}</h3><p>Dettagli sull'offerta (demo)</p>${spark(o.history)}`);
    return;
  }
  const share = e.target.closest('[data-share]');
  if(share){
    const o = DEALS.find(x=> x.id===share.getAttribute('data-share'));
    if(navigator.share){ navigator.share({title:o.title, text:'Guarda questa offerta', url:location.href}).catch(()=>{}); }
    else { alert('Copia il link dalla barra degli indirizzi.'); }
    return;
  }
});

/* ========= Ricerca + suggerimenti ========= */
const SKEY='recentSearches_v6';
function loadRecent(){ return JSON.parse(localStorage.getItem(SKEY) || '[]'); }
function saveRecent(arr){ localStorage.setItem(SKEY, JSON.stringify(arr.slice(0,8))); }
function addRecent(term){
  term = term.trim().toLowerCase();
  if(!term) return;
  const list = loadRecent().filter(x=>x!==term);
  list.unshift(term); saveRecent(list);
}
function openSuggest(anchor){
  const list = loadRecent();
  const box = getSuggest();
  if(!list.length){ box.style.display='none'; return; }
  box.innerHTML = `<div class="head">Ricerche recenti</div>` + list.map(t=>`<div class="sugg-item" data-term="${t}">${t}</div>`).join('');
  const r = anchor.getBoundingClientRect();
  box.style.left = Math.max(8, r.left) + 'px';
  box.style.top  = (r.bottom + 6) + 'px';
  box.style.width = Math.min(360, Math.max(220, r.width)) + 'px';
  box.style.display = 'block';
}
function closeSuggest(){ getSuggest().style.display='none'; }
function getSuggest(){ let b=qs('#suggest'); if(!b){ b=document.createElement('div'); b.id='suggest'; b.className='suggest'; document.body.appendChild(b);} return b; }
function doSearch(term){
  term = (term||'').trim();
  if(!term) return;
  QUERY = term;
  addRecent(term);
  closeSuggest();
  render();
}
qs('#q').addEventListener('focus', e=> openSuggest(e.target));
qs('#q').addEventListener('blur', ()=> setTimeout(closeSuggest, 120));
qs('#q').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); doSearch(qs('#q').value); }});
qs('#btnSearch').addEventListener('click', ()=> doSearch(qs('#q').value));
document.body.addEventListener('click', (e)=>{
  const it = e.target.closest('.sugg-item'); if(!it) return;
  const t = it.getAttribute('data-term'); qs('#q').value = t; doSearch(t);
});

/* ========= Burger Popover ========= */
const pop = qs('#popMenu'); const scrim = qs('#popScrim'); const burger = qs('#btnBurger');
function gutters(){
  const main = qs('main.container'); const vw = innerWidth;
  const rect = main ? main.getBoundingClientRect() : {left:12, right: vw-12};
  return { left: Math.max(0, rect.left), right: Math.max(0, vw - rect.right), vw };
}
function placePop(){
  const r = burger.getBoundingClientRect();
  const {left:gL, right:gR, vw} = gutters();
  pop.style.visibility='hidden'; pop.style.display='block';
  const pw = pop.offsetWidth, ph = pop.offsetHeight;
  pop.style.visibility='';
  const vh = innerHeight;
  const spaceBelow = vh - (r.bottom + 12);
  const openTop = spaceBelow < ph;
  const top = openTop ? (r.top - ph - 12) : (r.bottom + 12);
  const left = gL;
  pop.style.top = top + 'px'; pop.style.left = left + 'px';
  pop.style.maxWidth = Math.max(220, vw - gL - gR - 2) + 'px';
  const ox = (r.left + r.width/2) - left;
  pop.style.setProperty('--pop-ox', ox + 'px');
  pop.style.setProperty('--caret-x', (Math.min(pw-18, Math.max(12, ox)) - 6) + 'px');
  pop.style.setProperty('--caret-top', openTop ? (ph - 6) + 'px' : '-6px');
}
function openPop(){ placePop(); scrim.style.display='block'; pop.classList.add('open'); burger.setAttribute('aria-expanded','true'); }
function closePop(){ pop.classList.remove('open'); setTimeout(()=>{pop.style.display='none'; scrim.style.display='none';}, 220); burger.setAttribute('aria-expanded','false'); }
burger.addEventListener('click', ()=> pop.classList.contains('open')? closePop(): openPop());
scrim.addEventListener('click', closePop);
addEventListener('resize', ()=>{ if(pop.classList.contains('open')) placePop(); }, {passive:true});
addEventListener('scroll', ()=>{ if(pop.classList.contains('open')) placePop(); }, {passive:true});
// Handle device rotation: reopen automatically if it was open
addEventListener('orientationchange', ()=>{
  try{
    const wasOpen = pop.classList.contains('open');
    closePop();
    pop.style.removeProperty('top'); pop.style.removeProperty('left');
    if(wasOpen){ setTimeout(()=>{ openPop(); }, 420); }
  }catch(e){}
});
document.addEventListener('visibilitychange', ()=>{ if(document.hidden) closePop(); });
pop.addEventListener('click', (e)=>{
  const it = e.target.closest('.pop-item'); if(!it) return;
  const key = it.getAttribute('data-open');
  closePop();
  if(key==='home'){ SORT='best'; CAT='all'; QUERY=''; qs('#q').value=''; render(); return; }
  if(key==='guides'){ openList('m-guides', GUIDES, true); return; }
  if(key==='about'){ openModal('m-about'); return; }
  if(key==='blog'){ openList('m-blog', POSTS, false); return; }
  if(key==='favs'){ qs('#favToggle').click(); return; }
  if(key==='settings'){ openModal('m-settings'); return; }
  if(key==='privacy'){ openModal('m-privacy'); return; }
  if(key==='cookie'){ openModal('m-cookie'); return; }
  if(key==='tos'){ openModal('m-tos'); return; }
  if(key==='contact'){ openModal('m-contact'); return; }
});

/* ========= Modali + Liste ========= */
function openModal(id){ qs('#'+id).style.display='flex'; }
function closeAllModals(){ qsa('.modal').forEach(m=> m.style.display='none'); }
qsa('[data-close]').forEach(b=> b.addEventListener('click', closeAllModals));
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeAllModals(); });
function openArticle(html){ qs('#article').innerHTML = html; openModal('m-article'); }
function openList(id, items, isGuide){
  const tgt = qs('#'+id);
  const grid = tgt.querySelector(isGuide?'#guides':'#blog');
  grid.innerHTML = items.map(x=>`<article class="card" data-id="${x.id}">\n<button class="fav-btn ${FAVS.has(x.id)?'active':''}" data-fav="${x.id}" aria-pressed="${FAVS.has(x.id)}" aria-label="Aggiungi ai preferiti">‚ù§Ô∏è</button><img src="https://images.unsplash.com/photo-1542401886-65d6c61db817?q=80&w=1200&auto=format&fit=crop" alt="" style="width:100%;aspect-ratio:16/9;object-fit:cover"><div class="content"><div class="title">${x.title}</div><p style="color:var(--muted)">${isGuide?x.excerpt:('Pubblicato il '+x.date)}</p><div class="cta"><button class="btn" data-read="${x.id}">Leggi</button></div></div></article>`).join('');
  openModal(id);
}
document.body.addEventListener('click', (e)=>{
  const read = e.target.closest('[data-read]');
  if(read){
    const id = read.getAttribute('data-read');
    const g = GUIDES.find(x=>x.id===id) || POSTS.find(x=>x.id===id);
    if(g) openArticle(`<h3>${g.title}</h3>${g.body||'<p>...</p>'}`);
  }
});

/* ========= Auth demo + preferiti ========= */
qs('#favToggle').addEventListener('click', ()=>{
  const favs = DEALS.filter(o=> FAVS.has(o.id));
  const html = favs.length ? favs.map(o=>`<div class="card"><div class="content"><div class="title">${o.title}</div>${o.desc?`<p class="desc">${o.desc}</p>`:""}<div class="price"><span class="now">${fmtEur(o.priceNow)}</span></div><a class="btn primary" href="${aff(Object.values(o.links)[0]||'#', o.merchant, o.id)}" target="_blank" rel="nofollow sponsored">Vai</a></div></div>`).join('') : "<p>Nessun preferito.</p>";
  qs('#favs').innerHTML = html; openModal('m-favs');
});
qs('#btnLogin').addEventListener('click', ()=> openModal('m-login'));
qs('#btnRegister').addEventListener('click', ()=> openModal('m-register'));
qs('#btnLogout').addEventListener('click', ()=> alert('Logout demo'));
qs('#doLogin').addEventListener('click', ()=>{ alert('Login ok (demo)'); closeAllModals(); });
qs('#doRegister').addEventListener('click', ()=>{ alert('Registrazione ok (demo)'); closeAllModals(); });

/* ========= Controlli: sort + cat (solo in alto) ========= */
function setSort(v){ SORT=v; render(); }
function setCat(v){ CAT=v; render(); }
(()=>{ const el = qs('#sortCompact'); if(el) el.addEventListener('change', e=> setSort(e.target.value)); })();
(()=>{ const el = qs('#catSelect'); if(el) el.addEventListener('change', e=> setCat(e.target.value)); })();
/* ========= Init ========= */
qs('#favCount').textContent = FAVS.size;
render();

// Open detailed modal for a deal
function openDealDetails(dealId){
  const d = DEALS.find(x=>x.id===dealId);
  if(!d){ console.warn('Deal not found', dealId); return; }
  const el = document.getElementById('deal-detail');
  const stars = '‚òÖ'.repeat(Math.round(d.rating||0)) + '‚òÜ'.repeat(5-Math.round(d.rating||0));
  const couponBtn = d.coupon ? `<button class="btn ghost" data-copy="${d.coupon}" title="Copia coupon">${d.coupon}</button>` : '';
  const badgeList = [`${d.merchant?.toUpperCase()||'STORE'}`, d.discount?`-${d.discount}%`:'', d.reviews?`${d.reviews} recensioni`:'' ].filter(Boolean).map(b=>`<span class="badge">${b}</span>`).join('');
  const thumbs = (d.gallery||[d.image]).map((src,i)=>`<img src="${src}" alt="anteprima ${i+1}" data-main="${src}">`).join('');
  const specs = (d.specs||[]).map(s=>`<li><span>${s[0]}</span><span>${s[1]}</span></li>`).join('');
  const pros = (d.pros||[]).map(p=>`<li>‚úÖ ${p}</li>`).join('');
  const cons = (d.cons||[]).map(c=>`<li>‚ö†Ô∏è ${c}</li>`).join('');

  el.innerHTML = `
    <div class="deal-head">
      <div style="flex:1">
        <h4 class="deal-title">${d.title}</h4>
        <div class="deal-meta">${stars} <span>¬∑</span> <span>${d.rating?.toFixed?d.rating.toFixed(1):d.rating || 'N.D.'} / 5</span> <span>¬∑</span> <span>${d.reviews||0} recensioni</span></div>
        <div class="deal-price"><span class="now">‚Ç¨${d.priceNow?.toFixed?d.priceNow.toFixed(2):d.priceNow}</span>${d.priceWas?`<span class="was">‚Ç¨${d.priceWas}</span>`:''}</div>
        <div class="deal-actions">
          <a class="btn primary" href="${(d.links&& (d.links.amazon||d.links.awin||d.links.tradedoubler)) || '#'}" target="_blank" rel="nofollow noopener">Vedi su ${d.store||'negozio'}</a>
          ${couponBtn}
          <button class="btn ghost" data-fav="${d.id}">‚ù§Ô∏è Preferito</button>
          <button class="btn ghost" data-share="${d.id}">Condividi</button>
        </div>
        <div class="badges" style="margin-top:8px">${badgeList}</div>
      </div>
    </div>

    <div class="detail-grid">
      <div class="gallery">
        <img class="main-img" src="${(d.gallery&&d.gallery[0]) || d.image}" alt="${d.title}" id="detail-main">
        <div class="thumbs">${thumbs}</div>
      </div>
      <div class="specs">
        <h4>Specifiche essenziali</h4>
        <ul>${specs || '<li>Dati in aggiornamento</li>'}</ul>
        <div class="longdesc" style="margin-top:10px">${d.longDesc || d.desc || ''}</div>
        <div class="pros-cons">
          <div class="box pros"><h5>Pro</h5><ul>${pros||'<li>-</li>'}</ul></div>
          <div class="box cons"><h5>Contro</h5><ul>${cons||'<li>-</li>'}</ul></div>
        </div>
        <p class="disclosure">Trasparenza: potremmo ricevere una piccola commissione dagli acquisti idonei. Il prezzo per te non cambia.</p>
      </div>
    </div>
  `;

  // Thumbs interaction
  el.querySelectorAll('.thumbs img').forEach(img=>{
    img.addEventListener('click', ()=>{
      const main = el.querySelector('#detail-main');
      main.src = img.getAttribute('data-main');
    });
  });

  // Copy coupon
  el.querySelectorAll('[data-copy]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(btn.getAttribute('data-copy')); btn.textContent='Copiato!'; setTimeout(()=>btn.textContent=d.coupon, 1600); }catch(e){ alert('Copia non supportata'); }
    });
  });

  // Favorite
  el.querySelectorAll('[data-fav]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      toggleFavorite(d.id);
      btn.textContent = isFavorite(d.id) ? '‚ù§Ô∏è Nei preferiti' : '‚ù§Ô∏è Preferito';
    });
  });

  // Share (fallback)
  el.querySelectorAll('[data-share]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const shareData = { title: d.title, text: d.title, url: (d.links&& (d.links.amazon||d.links.awin||d.links.tradedoubler)) || location.href };
      if(navigator.share){ try{ await navigator.share(shareData); }catch(e){} }
      else{ await navigator.clipboard.writeText(shareData.url); btn.textContent='Link copiato'; setTimeout(()=>btn.textContent='Condividi',1400); }
    });
  });

  openModal('m-deal');
}


// Delegated: open details from cards
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('.btn-details');
  if(btn){ e.preventDefault(); openDealDetails(btn.getAttribute('data-id')); }
  const imgCard = e.target.closest('.card')?.querySelector('img');
  // Optionally: click on image opens details
  if(e.target.tagName==='IMG' && e.target.closest('.card')){
    const id = e.target.closest('.card').getAttribute('data-id');
    if(id){ openDealDetails(id); }
  }
});

</script>

<script id="os-automap">
(function(){
  const DEBUG = false;
  const log = (...a)=> DEBUG && console.log('[os-automap]', ...a);
  function getOffersArray(){
    const cands=['DEALS','deals','offers','OFFERTE','products','items'];
    for(const k of cands){ if(Array.isArray(window[k])) return window[k]; }
    const nested=[['App','state','deals'],['App','state','offers'],['APP','DEALS'],['app','deals']];
    for(const path of nested){ let cur=window; for(const key of path){ cur=cur?.[key]; } if(Array.isArray(cur)) return cur; }
    return [];
  }
  function normalize(o){
    const links=o.links||{}; const url=typeof links==='string'?links:(links.amazon||links.awin||links.default||links.url||o.url||'');
    const gallery=Array.isArray(o.gallery)?o.gallery:(Array.isArray(links.gallery)?links.gallery:[]);
    const image=o.image||o.img||o.thumbnail||(gallery&&gallery[0])||'';
    const now=Number(o.priceNow??o.price_now??o.price??o.current_price??o.prezzo??0);
    const was=Number(o.priceWas??o.price_was??o.was??o.old_price??o.listPrice??o.prezzo_pieno??0);
    let discount=Number(o.discount??o.sconto??0); if(!discount && now && was) discount=Math.round(100-(now*100/was));
    return { id:String(o.id??o.sku??o.asin??o.code??''), title:o.title??o.name??'', desc:o.desc??o.subtitle??o.shortDesc??o.short_description??'',
      rating:Number(o.rating??o.rate??o.stars??0), reviews:Number(o.reviews??o.reviewCount??o.n_reviews??o.ratings??0), cat:o.cat??o.category??'',
      store:o.store??o.merchant??o.seller??o.brand??'', priceNow:now, priceWas:was, discount, coupon:o.coupon??o.promo??o.couponCode??null,
      image, url, gallery, specs:o.specs??[], pros:o.pros??[], cons:o.cons??[], history:o.history??[],
      longDesc:o.longDesc??o.long_description??o.descrizione_completa??o.body??'' };
  }
  function toAttr(el,name,value){ if(value==null) return; if(Array.isArray(value)||(typeof value==='object' && value)){ try{ value=JSON.stringify(value);}catch(_){return;} } el.setAttribute(name,String(value)); }
  function mapCard(card,o){
    if(card.hasAttribute('data-title')) return;
    toAttr(card,'data-id',o.id||card.getAttribute('data-id')||''); toAttr(card,'data-title',o.title); toAttr(card,'data-price',o.priceNow); toAttr(card,'data-was',o.priceWas);
    toAttr(card,'data-discount',o.discount); toAttr(card,'data-store',o.store); toAttr(card,'data-cat',o.cat); toAttr(card,'data-reviews',o.reviews); toAttr(card,'data-rating',o.rating);
    toAttr(card,'data-image',o.image); toAttr(card,'data-url',o.url); toAttr(card,'data-coupon',o.coupon); toAttr(card,'data-gallery',o.gallery); toAttr(card,'data-specs',o.specs);
    toAttr(card,'data-pros',o.pros); toAttr(card,'data-cons',o.cons); toAttr(card,'data-history',o.history); toAttr(card,'data-longdesc',o.longDesc);
    const img=card.querySelector('img'); if(img){ toAttr(img,'data-detail-id',o.id||card.getAttribute('data-id')||''); toAttr(img,'data-title',o.title); toAttr(img,'data-price',o.priceNow);
      toAttr(img,'data-was',o.priceWas); toAttr(img,'data-discount',o.discount); toAttr(img,'data-store',o.store); toAttr(img,'data-cat',o.cat); toAttr(img,'data-reviews',o.reviews);
      toAttr(img,'data-rating',o.rating); toAttr(img,'data-image',o.image||img.src); toAttr(img,'data-url',o.url); toAttr(img,'data-coupon',o.coupon); toAttr(img,'data-gallery',o.gallery);
      toAttr(img,'data-specs',o.specs); toAttr(img,'data-pros',o.pros); toAttr(img,'data-cons',o.cons); toAttr(img,'data-history',o.history); toAttr(img,'data-longdesc',o.longDesc); }
  }
  function indexBy(arr,key){ const m=new Map(); arr.forEach(o=>{ const id=String(o[key]||''); if(id) m.set(id,o); }); return m; }
  function norm(s){ return String(s||'').toLowerCase().replace(/\s+/g,' ').trim(); }
  function run(){
    const src=getOffersArray().map(normalize); const byId=indexBy(src,'id'); const byTitle=indexBy(src,'title');
    document.querySelectorAll('.card').forEach((card,idx)=>{
      if(card.hasAttribute('data-title')) return;
      const cid=card.getAttribute('data-id'); const t=(card.querySelector('.title')?.textContent||'').trim(); let obj=null;
      if(cid && byId.has(cid)) obj=byId.get(cid);
      else if(t){ const key=norm(t); for(const [title,o] of byTitle.entries()){ if(norm(title)===key){ obj=o; break; } } }
      if(!obj && src[idx]) obj=src[idx];
      if(obj) mapCard(card,obj);
    });
  }
  function ready(fn){ if(document.readyState!=='loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }
  ready(run); new MutationObserver(()=> run()).observe(document.documentElement,{childList:true,subtree:true});
})();
</script>
<script id="os-spa-subpages-js">
(function(){
  if(window.__OS_SPA_INIT__) return; window.__OS_SPA_INIT__ = true;
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
  const nf=new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR',maximumFractionDigits:0});
  if(!window.__OS_BASE_TITLE) window.__OS_BASE_TITLE = document.title;

  function findMount(){
    const cards = $$('.card');
    if(!cards.length) return null;
    let best = null, maxCount = 0;
    cards.forEach(c=>{
      let a=c.parentElement;
      while(a && a!==document.body){
        const count = a.querySelectorAll ? a.querySelectorAll('.card').length : 0;
        if(count>=cards.length*0.6 && count>maxCount){ best=a; maxCount=count; }
        a=a.parentElement;
      }
    });
    return best || cards[0].parentElement;
  }

  const MOUNT = findMount();
  if(!MOUNT) return;
  const HOME_HTML = MOUNT.innerHTML;

  function collectOffers(){
    const arr = (Array.isArray(window.DEALS)&&window.DEALS)
             || (Array.isArray(window.deals)&&window.deals)
             || (Array.isArray(window.offers)&&window.offers)
             || [];
    const fromGlobal = arr.map(o=>{
      const title = o.title || o.name || '';
      const now   = Number(o.priceNow ?? o.price ?? o.current_price ?? 0);
      const was   = Number(o.priceWas ?? o.old_price ?? 0);
      const pct   = o.discount ?? (was && now ? Math.round(100 - (now*100/was)) : 0);
      const url   = (o.links && (o.links.amazon || o.links.awin || o.links.default)) || o.url || null;
      return {title, now, was, pct, url};
    }).filter(x=>x.title);
    if(fromGlobal.length) return fromGlobal;

    return $$('.card').map(card=>{
      const title=(card.querySelector('.title')?.textContent||'').trim();
      const nowTxt=(card.querySelector('.now')?.textContent||'').replace(/[^\d]/g,'');
      const wasTxt=(card.querySelector('.was')?.textContent||'').replace(/[^\d]/g,'');
      const now=Number(nowTxt||0), was=Number(wasTxt||0);
      const pctEl=card.querySelector('.discount'); let pct=0;
      if(pctEl){ const m=pctEl.textContent.match(/-?(\d+)\s*%/); if(m) pct=Number(m[1]); }
      const url = card.querySelector('.btn.primary')?.getAttribute('href') || null;
      return {title, now, was, pct, url};
    }).filter(x=>x.title);
  }
  function buildTicker(items){
    const part = items.map(it=>{
      const price = it.now ? nf.format(it.now) : '';
      the_pct = it.pct ? ` (-${it.pct}%)` : '';
      const text = `${it.title} ‚Äî ${price}${the_pct}`.trim();
      return it.url ? `<a class="item" href="${it.url}" target="_blank" rel="nofollow sponsored">üí• <b>${text}</b></a>`
                    : `<span class="item">üí• <b>${text}</b></span>`;
    }).join('');
    return `<div class="track">${part}${part}</div>`;
  }

  function getDataForCard(card){
    const get = (n)=> card.getAttribute(n);
    const parse = (n)=>{ try{ const v=get(n); return v?JSON.parse(v):null; }catch(_){ return null; } };
    let data = {
      id: get('data-id') || card.getAttribute('data-detail-id') || '',
      title: get('data-title') || (card.querySelector('.title')?.textContent || ''),
      pros: parse('data-pros') || [],
      cons: parse('data-cons') || [],
      longDesc: get('data-longdesc') || ''
    };
    if((!data.pros.length || !data.cons.length || !data.longDesc) && (window.DEALS || window.deals || window.offers)){
      const arr = window.DEALS || window.deals || window.offers;
      const found = Array.isArray(arr) ? arr.find(x=> String(x.id)===String(data.id) || (x.title && data.title && String(x.title).trim().toLowerCase()===String(data.title).trim().toLowerCase())) : null;
      if(found){
        data.pros = data.pros.length ? data.pros : (found.pros||[]);
        data.cons = data.cons.length ? data.cons : (found.cons||[]);
        data.longDesc = data.longDesc || found.longDesc || found.description_long || found.desc_long || '';
      }
    }
    return data;
  }

  function renderHome(replaceState=false){
    MOUNT.innerHTML = HOME_HTML;
    
    document.title = window.__OS_BASE_TITLE || document.title;document.body.classList.remove('os-subpage-open');
    if(replaceState){ history.replaceState({page:'home'}, '', location.pathname + location.search); }
  }

  function renderDetailFromCard(card, push=true){
    const sub = document.createElement('div');
    sub.className = 'os-subpage';

    const header = document.createElement('div');
    header.className = 'os-subheader';
    const titleText = card.getAttribute('data-title') || (card.querySelector('.title')?.textContent || '');
    header.innerHTML = `<div class="row">
      <a href="#" class="back" data-os-back>‚Üê Torna alla home</a>
      <div class="brand"><span class="label">Scheda dettaglio:</span> <span class="prod-title"></span></div>
    </div>`;
    header.querySelector('.prod-title').textContent = titleText;
    
    document.title = `Dettaglio ‚Äî ${titleText}`;sub.appendChild(header);

    const clone = card.cloneNode(true);
    clone.querySelectorAll('a,button').forEach(function(el){
      const txt = (el.textContent||'').trim().toLowerCase();
      if (txt.startsWith('dettagli') || el.matches('.btn-detail, .open-detail') || el.getAttribute('href')==='#m-deal' || el.getAttribute('data-bs-target')==='#m-deal' || el.getAttribute('data-target')==='#m-deal') {
        el.remove();
      }
    });
    clone.querySelectorAll('[data-open-detail], [data-detail], [data-detail-id]').forEach(function(el){
      el.removeAttribute('data-open-detail');
      el.removeAttribute('data-detail');
      el.removeAttribute('data-detail-id');
    });
    clone.querySelectorAll('a').forEach(function(a){
      if(a.querySelector('img')){
        const frag = document.createDocumentFragment();
        while(a.firstChild){ frag.appendChild(a.firstChild); }
        a.replaceWith(frag);
      }
    });
    clone.querySelectorAll('img').forEach(function(img){
      ['onclick','role','tabindex'].forEach(attr=> img.removeAttribute(attr));
      img.style.pointerEvents='none'; img.style.cursor='default';
    });

    const target = clone.querySelector('.content') || clone;
    const data = getDataForCard(card);
    const prosHTML = (data.pros||[]).map(x=> `<li>‚úÖ ${x}</li>`).join('') || '<li>‚Äî</li>';
    const consHTML = (data.cons||[]).map(x=> `<li>‚ö†Ô∏è ${x}</li>`).join('') || '<li>‚Äî</li>';
    const longHTML = data.longDesc || '';
    const extra = document.createElement('div');
    extra.innerHTML = `
      <div class="pc">
        <div class="box pro">
          <h5>Pro</h5>
          <ul style="margin:0 0 0 18px">${prosHTML}</ul>
        </div>
        <div class="box con">
          <h5>Contro</h5>
          <ul style="margin:0 0 0 18px">${consHTML}</ul>
        </div>
      </div>
      ${longHTML ? `<p class="long">${longHTML}</p>` : ''}
    `;
    target.appendChild(extra);

    sub.appendChild(clone);

    MOUNT.innerHTML = '';
    MOUNT.appendChild(sub);
    document.body.classList.add('os-subpage-open');

    sub.querySelector('[data-os-back]').addEventListener('click', (e)=>{
      e.preventDefault();
      history.back();
    });

    if(push){
      const id = card.getAttribute('data-id') || data?.id || '';
      const title = (card.querySelector('.title')?.textContent || 'dettaglio');
      const slug = title.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'');
      const url = id ? `#/deal/${encodeURIComponent(id)}-${slug}` : '#/deal';
      history.pushState({page:'deal', id}, '', url);
    }
  }

  function handleRoute(){
    const hash = location.hash || '';
    if(hash.startsWith('#/deal/')){
      const idSlug = hash.split('#/deal/')[1] || '';
      const id = idSlug.split('-')[0];
      let card = null;
      if(id){ card = document.querySelector(`.card[data-id="${CSS.escape(id)}"]`) || document.querySelector(`.card [data-detail-id="${CSS.escape(id)}"]`)?.closest('.card'); }
      if(card){ renderDetailFromCard(card, false); return; }
      const first = document.querySelector('.card');
      if(first){ renderDetailFromCard(first, false); return; }
      renderHome(true);
    }else{
      renderHome(true);
    }
  }

  document.addEventListener('click', function(e){
    if(e.target.closest('.os-subpage')){
      const isImg = !!e.target.closest('.card img');
      const btn = e.target.closest('button, a');
      const isDetails = btn && ((btn.textContent||'').trim().toLowerCase().startsWith('dettagli'));
      if(isImg || isDetails){ e.preventDefault(); e.stopImmediatePropagation(); return; }
      return;
    }
    const img = e.target.closest('.card img');
    const btn = e.target.closest('button, a');
    const isDetails = btn && ((btn.textContent||'').trim().toLowerCase().startsWith('dettagli'));
    const legacy = e.target.closest('a[href^="#m-deal"], [data-bs-target="#m-deal"], [data-target="#m-deal"]');
    if(img || isDetails || legacy){
      e.preventDefault(); e.stopImmediatePropagation();
      const el = img || btn || legacy;
      const card = el.closest('.card');
      if(card) renderDetailFromCard(card, true);
    }
  }, true);

  window.addEventListener('popstate', handleRoute);
  handleRoute();
})();
</script>




<script id="os-header-ticker-js">
(function(){
  if(window.__HEADER_TICKER_INIT__) return; window.__HEADER_TICKER_INIT__=true;
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
  const nf=new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'});

  function collectOffers(){
    const arr = (Array.isArray(window.DEALS)&&window.DEALS) || (Array.isArray(window.deals)&&window.deals) || (Array.isArray(window.offers)&&window.offers) || [];
    const glob = arr.map(o=>{
      const title = o.title || o.name || '';
      const now   = Number(o.priceNow ?? o.price ?? o.current_price ?? 0);
      const was   = Number(o.priceWas ?? o.old_price ?? 0);
      const pct   = o.discount ?? (was && now ? Math.round(100 - (now*100/was)) : 0);
      const url   = (o.links && (o.links.amazon || o.links.awin || o.links.default)) || o.url || null;
      return {title, now, was, pct, url};
    }).filter(x=>x.title);
    if(glob.length) return glob;

    return $$('.card').map(card=>{
      const title=(card.querySelector('.title')?.textContent||'').trim();
      const nowTxt=(card.querySelector('.now')?.textContent||'').replace(/[^\d]/g,'');
      const wasTxt=(card.querySelector('.was')?.textContent||'').replace(/[^\d]/g,'');
      const now=Number(nowTxt||0), was=Number(wasTxt||0);
      const pctEl=card.querySelector('.discount'); let pct=0;
      if(pctEl){ const m=pctEl.textContent.match(/-?(\d+)\s*%/); if(m) pct=Number(m[1]); }
      const url = card.querySelector('.btn.primary')?.getAttribute('href') || null;
      return {title, now, was, pct, url};
    }).filter(x=>x.title);
  }

  function initHeaderTicker(){
    const hInner = document.querySelector('#hInner') || document.querySelector('header');
    if(!hInner) return;
    const search = hInner.querySelector('.search, form[role="search"], .searchbar, #search, input[type="search"]');

    let wrap = hInner.querySelector('#headerTicker');
    if(!wrap){ wrap = document.createElement('div'); wrap.id='headerTicker'; wrap.className='ticker-wrap'; }
    if(search && search.parentNode){
      const parent=search.parentNode;
      if(wrap.parentNode!==parent || wrap.previousElementSibling!==search){
        if(search.nextSibling){ parent.insertBefore(wrap, search.nextSibling); }
        else { parent.appendChild(wrap); }
      }
    } else {
      if(wrap.parentNode!==hInner) hInner.appendChild(wrap);
    }
    let inner = wrap.querySelector('.ticker'); if(!inner){ inner=document.createElement('div'); inner.className='ticker'; wrap.appendChild(inner); }
    let track = wrap.querySelector('#tickerTrack'); if(!track){ track=document.createElement('div'); track.id='tickerTrack'; track.className='ticker-track'; inner.appendChild(track); }

    const items = collectOffers();
    const html = items.map(it=>{
      const price = it.now ? nf.format(it.now) : '';
      const pct = it.pct ? ` (-${it.pct}%)` : '';
      const text = `${it.title} ‚Äî ${price}${pct}`.trim();
      const href = it.url || '#';
      return `<a class="tick" href="${href}" target="_blank" rel="nofollow sponsored">üí• <b>${text}</b></a>`;
    }).join('');

    track.innerHTML = html || '<span class="tick"><b>Offerteshock</b> ‚Äî offerte in aggiornamento‚Ä¶</span>';
  }

  if(document.readyState!=='loading') initHeaderTicker();
  else document.addEventListener('DOMContentLoaded', initHeaderTicker);
  window.addEventListener('load', initHeaderTicker);
})();
</script>

<script>
(function(){
  if (window.__NO_RELOAD_SAME_PAGE__) return; window.__NO_RELOAD_SAME_PAGE__ = true;
  function samePath(aHref){
    try{
      const url = new URL(aHref, location.href);
      const to  = url.pathname.replace(/\/$/, '/index.html');
      const cur = location.pathname.replace(/\/$/, '/index.html');
      return (url.origin === location.origin) && (to === cur);
    }catch(e){ return false; }
  }
  document.addEventListener('click', function(e){
    const a = e.target.closest('a');
    if(!a || !a.href) return;
    if(samePath(a.href)){
      e.preventDefault();
      // Close burger if open
      const pop = document.getElementById('popMenu'); 
      const scr = document.getElementById('popScrim');
      if(pop) pop.classList.remove('open');
      if(scr) scr.style.display='none';
    }
  }, true);
})();
</script>





<script id="os-subpage-rename-only">
(function(){
  if (window.__OS_SUBPAGE_RENAME_ONLY__) return; window.__OS_SUBPAGE_RENAME_ONLY__ = true;
  // On subpage mount: find original "Torna alla Home" control and just rename its text to "Chiudi Dettagli".
  const obs = new MutationObserver(function(muts){
    muts.forEach(function(m){
      (m.addedNodes||[]).forEach(function(node){
        if (!node || node.nodeType!==1 || !node.classList) return;
        if (!(node.classList.contains('os-subpage') || node.matches('[class*="subpage"]'))) return;
        try{
          // Prefer data-os-back
          let backBtn = node.querySelector('[data-os-back]');
          if (!backBtn){
            const cands = node.querySelectorAll('a,button');
            for (const el of cands){
              const t = (el.textContent||'').trim();
              if (/torna alla home/i.test(t)){ backBtn = el; break; }
            }
          }
          if (backBtn){
            // Only change the label; DO NOT modify handlers
            backBtn.textContent = 'Chiudi Dettagli';
          }
          // Remove any extra close buttons we may have added earlier
          node.querySelectorAll('.detail-actions-right, .btn-close-detail, [data-os-close].close').forEach(function(el){
            if (el !== backBtn) el.remove();
          });
        }catch(_){}
      });
    });
  });
  obs.observe(document.documentElement, {childList:true, subtree:true});
})();
</script>




<script id="os-subpage-dup-close-targeted-centered-v2">
(function(){
  if (window.__OS_SUBPAGE_DUP_CLOSE_TARGETED_CENTERED_V2__) return; window.__OS_SUBPAGE_DUP_CLOSE_TARGETED_CENTERED_V2__ = true;

  function findHeaderRowWithTitle(root){
    const all = root.querySelectorAll('*');
    for (const el of all){
      try{
        const t = (el.textContent||'').trim();
        if (/^Scheda dettaglio:/i.test(t)){
          return el.closest('.row') || el.closest('.os-subheader') || root.querySelector('.os-subheader') || el.parentElement || root;
        }
      }catch(_){}
    }
    return root.querySelector('.os-subheader .row') || root.querySelector('.os-subheader') || root;
  }

  const obs = new MutationObserver(function(muts){
    muts.forEach(function(m){
      (m.addedNodes||[]).forEach(function(node){
        if (!node || node.nodeType!==1 || !node.classList) return;
        if (!(node.classList.contains('os-subpage') || node.matches('[class*="subpage"]'))) return;
        try{
          const sub = node;

          // Locate original back control
          let backBtn = sub.querySelector('[data-os-back]');
          if (!backBtn){
            const cands = sub.querySelectorAll('a,button');
            for (const el of cands){
              const t = (el.textContent||'').trim();
              if (/torna alla home/i.test(t) || /chiudi dettagli/i.test(t)){ backBtn = el; break; }
            }
          }
          if (!backBtn) return;

          // Standardize left button
          backBtn.textContent = 'Chiudi Dettagli';
          backBtn.classList.add('btn-close-detail', 'btn-close-detail-left');
          backBtn.style.position = 'static';
          backBtn.style.float = 'none';

          // Get the header row that contains the "Scheda dettaglio:" title
          const row = findHeaderRowWithTitle(sub);

          // Force a 3-column grid row: [left btn] [center title] [right btn]
          row.setAttribute('data-os-grid', 'row3');
          row.style.display = 'grid';
          row.style.gridTemplateColumns = 'auto 1fr auto';
          row.style.alignItems = 'center';
          row.style.columnGap = '12px'; row.style.paddingTop='0'; row.style.paddingBottom='0'; row.style.height='44px';

          // Center title/brand
          const brand = row.querySelector('.brand') || row;
          brand.style.gridColumn = '2';
          brand.style.textAlign = 'center';
          brand.style.minWidth = '0';
          brand.style.overflow = 'hidden';
          brand.style.textOverflow = 'ellipsis';
          brand.style.whiteSpace = 'nowrap';

          // Ensure left button is placed in column 1
          try{ row.insertBefore(backBtn, row.firstChild); }catch(_){}
          backBtn.style.gridColumn = '1';
          backBtn.style.justifySelf = 'start';

          // Remove previous mirrors to avoid duplicates
          row.querySelectorAll('.btn-close-detail-mirror').forEach(el=>el.remove());

          // Create right mirror in column 3
          const mirror = backBtn.cloneNode(true);
          mirror.classList.add('btn-close-detail-mirror', 'btn-close-detail-right');
          mirror.removeAttribute('href');
          mirror.style.gridColumn = '3';
          mirror.style.justifySelf = 'end';
          mirror.addEventListener('click', function(ev){
            ev.preventDefault(); ev.stopImmediatePropagation();
            try{ backBtn.click(); }catch(_){}
          }, true);

          row.appendChild(mirror);
        }catch(_){}
      });
    });
  });
  obs.observe(document.documentElement, {childList:true, subtree:true});
})();
</script>
</body>
</html>

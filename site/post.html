<!doctype html><html lang="it"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="theme-color" content="#0b0e13"/><title>Domotica Lowcost: Guida Completa per Casa Intelligente</title>
<meta content="Domotica lowcost: tutto quello che devi sapere per rendere la tua casa intelligente senza spendere una fortuna. Guide, prodotti e consigli pratici." name="description"/>
<link rel="stylesheet" href="./assets/styles.css"/></head><body>
<header class="fullbleed">
<div class="h-inner" id="hInner">
<div class="brand">
<button aria-label="Menu" class="burger" id="btnBurger" title="Menu">‚ò∞</button>
<a href="index.html" class="home-link"><svg fill="none" viewbox="0 0 24 24"><path d="M4 7.5C4 6.12 5.12 5 6.5 5h3A2.5 2.5 0 0 1 12 7.5v9A2.5 2.5 0 0 1 9.5 19h-3A2.5 2.5 0 0 1 4 16.5v-9Z" fill="#22c55e"></path><path d="M12 7.5C12 6.12 13.12 5 14.5 5h3A2.5 2.5 0 0 1 20 7.5v1A2.5 2.5 0 0 1 17.5 11h-3A2.5 2.5 0 0 1 12 8.5v-1Z" fill="#3b82f6"></path></svg>
<span>Offerteshock.it</span></a>
</div>
<div id="authDock">
<div class="fav-pill" id="favToggle" title="Preferiti">‚ù§Ô∏è <span class="count" id="favCount">0</span></div>
<button class="btn xs" id="btnLogin">Login</button>
<button class="btn primary xs" id="btnRegister">Registrati</button>
<button class="btn xs" id="btnLogout" style="display:none">Logout</button>
</div>
<div class="search" role="search">
<div class="ctrl cat">
<span class="label" id="labCat">Categorie:</span>
<span class="select small"><select aria-labelledby="labCat" id="catSelect">
<option value="all">Tutte</option>
<option value="casa_cucina">Casa e Cucina</option>
<option value="animali">Prodotti per Animali</option>
<option value="bellezza">Bellezza &amp; Cura Persona</option>
<option value="fai_da_te">Fai da Te e Giardinaggio</option>
<option value="infanzia">Prodotti per l'Infanzia</option>
</select></span>
</div>
<div class="searchbar">
<input aria-label="Cerca" autocomplete="off" class="search-in" id="q" placeholder="Cerca brand, modello, categoria‚Ä¶" type="search"/>
<button aria-label="Esegui ricerca" class="btn ghost btn-search" id="btnSearch">Cerca</button>
</div>

</div>
</div>
</header>
<div aria-hidden="true" class="pop-scrim" id="popScrim"></div>
<div aria-hidden="true" class="pop" id="popMenu" role="menu">
<nav class="pop-nav">
<a class="pop-item" href="index.html">Home</a>
<a class="pop-item" href="about.html">Chi Siamo</a>
<a class="pop-item" href="guides.html">Guide</a>
<a class="pop-item" href="blog.html">Blog</a>
<a class="pop-item" href="favs.html">Preferiti</a>
<a class="pop-item" href="settings.html">Impostazioni</a>
<a class="pop-item" href="privacy.html">Privacy</a>
<a class="pop-item" href="cookie.html">Cookie</a>
<a class="pop-item" href="termini.html">Termini</a>
<a class="pop-item" href="contatti.html">Contatti</a>
</nav>
</div>




<main class="container">





<!-- Burger Popover + scrim -->



<main class="container">
<div class='section-head'><div class='section-title'>Articolo</div></div><section id='article' class='card' style='padding:12px'>
<h1>Domotica Lowcost: Guida Completa per Rendere la Tua Casa Intelligente Senza Spendere una Fortuna</h1>
<p>Benvenuto in questa guida completa sulla domotica lowcost! Se stai leggendo queste righe, probabilmente hai sentito parlare di case intelligenti, ma temi che sia qualcosa di troppo costoso o complicato. Niente di pi√π sbagliato! La domotica lowcost √® accessibile a tutti, e con i prodotti giusti puoi trasformare la tua abitazione in una casa smart senza svuotare il portafoglio. In questa guida, ti spiegher√≤ passo dopo passo come iniziare, quali dispositivi scegliere e come evitare gli errori comuni. Preparati a scoprire un mondo di comodit√† e risparmio energetico, tutto a portata di mano.</p>

<h2>Indice</h2>
<ol>
<li><a href="#introduzione">Introduzione</a></li>
<li><a href="#come-iniziare">Come Iniziare con la Domotica Lowcost</a></li>
<li><a href="#dispositivi-essenziali">I Dispositivi Essenziali per Casa Intelligente</a></li>
<li><a href="#automazioni-base">Automazioni Base che Cambiano la Vita</a></li>
<li><a href="#risparmio-energetico">Risparmio Energetico con la Domotica</a></li>
<li><a href="#sicurezza-casa">Sicurezza per la Tua Casa</a></li>
<li><a href="#errori-comuni">Errori Comuni da Evitare</a></li>
<li><a href="#conclusione">Conclusione</a></li>
</ol>

<h2 id="introduzione">Introduzione</h2>
<p>La domotica, o casa intelligente, non √® pi√π un lusso riservato ai ricchi. Con l'avvento di dispositivi lowcost come quelli di Shelly, Sonoff e altri brand accessibili, chiunque pu√≤ rendere la propria casa pi√π comoda, sicura ed efficiente. Immagina di accendere le luci con un comando vocale, ricevere notifiche se lasci una porta aperta o risparmiare sulla bolletta elettrica grazie a schedulazioni intelligenti. Tutto questo √® possibile senza investimenti esorbitanti.</p>
<p>In questa guida, ti accompagner√≤ in un viaggio passo dopo passo. Inizieremo dalle basi, passando per i dispositivi essenziali, fino ad arrivare a consigli pratici per ottimizzare il tuo setup. Non preoccuparti se sei un principiante: spiegher√≤ tutto in modo semplice, senza termini tecnici inutili. Alla fine, avrai tutte le informazioni necessarie per iniziare il tuo progetto di domotica lowcost.</p>

<h2 id="come-iniziare">Come Iniziare con la Domotica Lowcost</h2>
<h2 id="come-iniziare">Come Iniziare con la Domotica Lowcost</h2>
<p>Il primo passo √® capire che la domotica lowcost si basa su dispositivi WiFi o Zigbee che si collegano alla tua rete domestica. Non serve essere esperti di informatica: basta un'app sul telefono e una connessione internet stabile. Ecco cosa ti serve per partire:</p>
<ul>
<li><strong>Un router WiFi affidabile:</strong> Assicurati che il tuo modem supporti almeno WiFi 5. Se hai un vecchio modello, considera un upgrade lowcost. Un buon router costa intorno ai 50 euro e migliora la stabilit√† di tutti i dispositivi smart.</li>
<li><strong>Un assistente vocale:</strong> Amazon Echo Dot o Google Nest Mini sono perfetti per controllare i dispositivi con la voce. Costano poco pi√π di 30 euro e integrano facilmente con la maggior parte dei prodotti domotica.</li>
<li><strong>App dedicate:</strong> Ogni brand ha la sua app, ma esistono anche integratori come Home Assistant per un controllo centralizzato. Home Assistant √® gratuito e open source, ideale per chi vuole personalizzazioni avanzate.</li>
<li><strong>Strumenti base:</strong> Un cacciavite e un multimetro possono essere utili per installazioni semplici. Non serve essere elettricisti, ma attenzione alla sicurezza elettrica.</li>
</ul>
<p>Inizia con un dispositivo semplice, come un rel√® WiFi per le luci. Una volta che vedi i risultati, potrai espandere il sistema. Ricorda: la domotica lowcost cresce con te, non richiede un investimento iniziale enorme. Molti utenti iniziano con 50-100 euro e poi aggiungono dispositivi man mano che scoprono nuove possibilit√†.</p>
<p>Prima di comprare, verifica la compatibilit√† con il tuo sistema operativo. La maggior parte dei dispositivi funziona su Android e iOS, ma alcuni hanno app esclusive. Inoltre, considera la lingua: molte app sono in inglese, ma quelle italiane sono sempre pi√π comuni.</p>
<p>Un consiglio pratico: inizia con dispositivi dello stesso brand per evitare incompatibilit√†. Ad esempio, se scegli Shelly, tutti i prodotti si integrano facilmente. Se vuoi mischiare, usa piattaforme come Home Assistant come ponte.</p>

<h2 id="dispositivi-essenziali">I Dispositivi Essenziali per Casa Intelligente</h2>
<p>Ora entriamo nel vivo: quali dispositivi scegliere per la tua domotica lowcost? Ho selezionato quelli pi√π popolari e accessibili, con link ai nostri prodotti in offerta.</p>

<h3>Rel√® WiFi per Controllo Luci e Dispositivi</h3>
<p>Il Shelly Plus 1 √® un classico della domotica lowcost. Costa poco pi√π di 15 euro e permette di controllare qualsiasi luce o presa elettrica via app. Compatibile con Alexa e Google Home, √® ideale per principianti. Questo dispositivo si installa facilmente dietro un interruttore esistente e non richiede modifiche strutturali alla casa. La sua batteria integrata garantisce funzionamento anche in caso di blackout temporaneo, e il consumo energetico √® minimo, meno di 1 watt in standby.</p>
<p>Installazione: Basta collegarlo ai fili elettrici esistenti. Se non sei pratico, consulta un elettricista per sicurezza. Una volta configurato, puoi controllare il dispositivo da qualsiasi luogo con connessione internet. Le automazioni includono schedulazioni giornaliere, controllo basato sulla posizione del telefono e integrazione con sensori di movimento.</p>
<p><img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?q=80&w=1200&auto=format&fit=crop" alt="Shelly Plus 1 Rel√® WiFi" /></p>
<p>Pro: Facile installazione, consumo energetico basso, compatibilit√† universale. Contro: Richiede connessione WiFi stabile, non supporta Zigbee nativamente. Perfetto per: Automazioni base come accendere le luci al tramonto o spegnere dispositivi dimenticati. Molti utenti lo usano per controllare ventilatori, pompe o persino il cancello del garage.</p>
<p>Esempio pratico: Immagina di tornare a casa la sera. Con Shelly Plus 1, puoi accendere le luci esterne automaticamente al tramonto, simulando presenza e migliorando la sicurezza. Oppure, collega una presa elettrica per spegnere il televisore quando vai a dormire, risparmiando energia.</p>

<h3>Interruttori Intelligenti</h3>
<p>Il Sonoff Mini R2 sostituisce gli interruttori tradizionali senza bisogno di fili aggiuntivi. Con un prezzo intorno ai 10 euro, √® uno dei dispositivi pi√π venduti per domotica lowcost.</p>
<p><img src="https://images.unsplash.com/photo-1581094794329-c8112a89af12?q=80&w=1200&auto=format&fit=crop" alt="Sonoff Mini R2 Interruttore Intelligente" /></p>
<p>Pro: Design invisibile, automazioni avanzate. Contro: Richiede neutro. Ideale per: Case esistenti senza grandi modifiche.</p>

<h3>Telecamere di Sicurezza</h3>
<p>La TP-Link Tapo C200 offre videosorveglianza HD con movimento a meno di 30 euro. Rilevamento automatico e visione notturna inclusi.</p>
<p><img src="https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=1200&auto=format&fit=crop" alt="TP-Link Tapo C200 Videocamera" /></p>
<p>Pro: Pan/Tilt automatico, facile setup. Contro: Archiviazione cloud a pagamento. Perfetto per: Monitorare ingressi e stanze.</p>

<h3>Strisce LED Smart</h3>
<p>La Shelly RGBW2 permette di controllare colori e luminosit√† di strisce LED via app. Circa 30 euro, ideale per atmosfere personalizzate.</p>
<p><img src="https://images.unsplash.com/photo-1565814329452-e1efa11c5b89?q=80&w=1200&auto=format&fit=crop" alt="Shelly RGBW2 Striscia LED Smart" /></p>
<p>Pro: Milioni di colori, controllo remoto. Contro: Richiede alimentazione 12V. Ottimo per: Salotti e camere da letto.</p>

<h3>Termostati Intelligenti</h3>
<p>Il Sonoff TH16 gestisce temperatura e umidit√† con sensori integrati. Prezzo intorno ai 20 euro, perfetto per risparmio energetico. Questo dispositivo si collega al tuo sistema di riscaldamento esistente e permette di regolare la temperatura da remoto. I sensori interni misurano temperatura e umidit√† in tempo reale, adattando le impostazioni automaticamente.</p>
<p>Installazione: Sostituisce il termostato tradizionale. Richiede una connessione WiFi stabile per il controllo remoto. L'app Sonoff permette di creare schedulazioni settimanali, ideali per chi lavora o ha routine variabili.</p>
<p><img src="https://images.unsplash.com/photo-1590845947670-c009801ffa74?q=80&w=1200&auto=format&fit=crop" alt="Sonoff TH16 Termostato Intelligente" /></p>
<p>Pro: Sensori integrati, automazioni flessibili, display LCD chiaro. Contro: Solo rel√®, non termostato digitale avanzato; app necessaria per configurazioni complesse. Ideale per: Controllo riscaldamento e condizionamento in case piccole o appartamenti. Risparmia fino al 15% sulla bolletta energetica grazie a regolazioni precise.</p>
<p>Esempio pratico: Imposta il riscaldamento per accendersi 30 minuti prima del tuo ritorno dal lavoro. Oppure, abbassa la temperatura di notte per dormire meglio e risparmiare. Con il sensore di umidit√†, evita muffe in bagno o cucina.</p>
<p>Alternative: Se cerchi qualcosa di pi√π avanzato, considera modelli con termostato digitale, ma per lowcost, Sonoff TH16 √® imbattibile.</p>

<h3>Sensori di Sicurezza</h3>
<p>L'Aqara Door Sensor rileva aperture di porte e finestre. Batteria lunga durata, prezzo sotto i 15 euro.</p>
<p><img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?q=80&w=1200&auto=format&fit=crop" alt="Aqara Door Sensor" /></p>
<p>Pro: Batteria 2 anni, facile installazione. Contro: Richiede hub. Perfetto per: Notifiche di sicurezza.</p>

<h3>Monitor Energia</h3>
<p>Il Shelly 3EM misura il consumo elettrico in tempo reale. Circa 80 euro, aiuta a identificare sprechi.</p>
<p><img src="https://images.unsplash.com/photo-1621905251189-08b45d6a269e?q=80&w=1200&auto=format&fit=crop" alt="Shelly 3EM Monitor Energia" /></p>
<p>Pro: Misurazione precisa, app dettagliata. Contro: Prezzo elevato. Ottimo per: Ottimizzazione bollette.</p>

<h3>Sensori di Movimento</h3>
<p>Il Sonoff PIR3 accende luci automaticamente al movimento. Prezzo intorno ai 15 euro, opzione batteria solare.</p>
<p><img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?q=80&w=1200&auto=format&fit=crop" alt="Sonoff PIR3 Sensore Movimento" /></p>
<p>Pro: Batteria lunga, facile installazione. Contro: Sensibilit√† regolabile limitata. Ideale per: Corridoi e scale.</p>

<h2 id="automazioni-base">Automazioni Base che Cambiano la Vita</h2>
<p>Una volta installati i dispositivi, √® il momento delle automazioni. Ecco alcune idee semplici ma efficaci:</p>
<ul>
<li><strong>Accensione automatica delle luci:</strong> Usa un sensore di movimento per illuminare corridoi al buio.</li>
<li><strong>Controllo remoto:</strong> Spegni le luci dimenticate via app, anche da fuori casa.</li>
<li><strong>Schedulazioni:</strong> Accendi il riscaldamento solo quando serve, risparmiando energia.</li>
<li><strong>Notifiche di sicurezza:</strong> Ricevi avvisi se una porta rimane aperta troppo tempo.</li>
</ul>
<p>Queste automazioni non solo rendono la vita pi√π comoda, ma aiutano anche a ridurre i consumi. Inizia con una o due, poi espandi.</p>

<h2 id="risparmio-energetico">Risparmio Energetico con la Domotica</h2>
<p>Uno dei vantaggi principali della domotica lowcost √® il risparmio energetico. Con dispositivi come termostati intelligenti e monitor energia, puoi ridurre la bolletta fino al 20%. Ecco come:</p>
<ul>
<li><strong>Schedulazioni intelligenti:</strong> Accendi il riscaldamento solo quando sei a casa.</li>
<li><strong>Rilevamento presenza:</strong> Spegni luci e dispositivi quando non ci sei.</li>
<li><strong>Monitoraggio consumi:</strong> Identifica elettrodomestici energivori e ottimizza l'uso.</li>
</ul>
<p>Investendo in domotica lowcost, ti ripaghi da solo in pochi mesi grazie ai risparmi sulle bollette.</p>

<h2 id="sicurezza-casa">Sicurezza per la Tua Casa</h2>
<p>La sicurezza √® un aspetto cruciale. Con telecamere e sensori lowcost, puoi proteggere la tua casa senza costi elevati. Telecamere come la Tapo C200 offrono visione notturna e notifiche push, mentre sensori di porta ti avvisano di aperture sospette. Combina tutto con automazioni per simulare presenza quando sei via.</p>

<h2>Compatibilit√† e Integrazione dei Dispositivi</h2>
<p>Uno degli aspetti pi√π importanti della domotica lowcost √® la compatibilit√†. Non tutti i dispositivi parlano la stessa lingua, quindi √® essenziale scegliere prodotti che si integrino bene. Ecco una guida rapida:</p>
<ul>
<li><strong>Protocolli comuni:</strong> WiFi per semplicit√†, Zigbee per reti mesh affidabili, Bluetooth per dispositivi vicini.</li>
<li><strong>Assistenti vocali:</strong> Alexa, Google Assistant e Siri supportano la maggior parte dei dispositivi lowcost.</li>
<li><strong>Hub centralizzati:</strong> Per sistemi misti, usa un hub come Samsung SmartThings o Home Assistant.</li>
</ul>
<p>Prima di comprare, controlla le recensioni per compatibilit√†. Ad esempio, Shelly lavora bene con Alexa, mentre Aqara preferisce Google. Se hai dubbi, inizia con un brand e espandi gradualmente.</p>
<p>Un esempio: Se hai gi√† un Echo Dot, scegli dispositivi compatibili con Alexa per un setup immediato. Altrimenti, considera piattaforme open come Home Assistant, che supportano quasi tutto.</p>
<p>Ricorda: La domotica lowcost non deve essere perfetta fin dall'inizio. Puoi sempre aggiungere dispositivi o cambiare strategia man mano che impari.</p>

<h2 id="conclusione">Conclusione</h2>
<p>La domotica lowcost √® alla portata di tutti. Con dispositivi accessibili come Shelly e Sonoff, puoi rendere la tua casa intelligente senza spese folli. Inizia con le basi, sperimenta automazioni e goditi i vantaggi di comfort, sicurezza e risparmio. Se hai dubbi, consulta le nostre guide o contattaci. Ricorda: la chiave del successo √® iniziare piccolo e crescere gradualmente. Non scoraggiarti se qualcosa non funziona al primo tentativo; la domotica √® un processo di apprendimento continuo.</p>
<p>In questa guida, abbiamo visto come scegliere i dispositivi giusti, evitare errori comuni e massimizzare i benefici. La domotica lowcost non √® solo una moda, ma un investimento intelligente per il futuro. Con il risparmio energetico e l'aumento della sicurezza, ti ripagher√† nel tempo. Inoltre, contribuisce a un stile di vita pi√π sostenibile, riducendo l'impatto ambientale attraverso un uso pi√π efficiente delle risorse.</p>
<p>Ora tocca a te: scegli il primo dispositivo, installalo e inizia il tuo viaggio nella casa intelligente. Se hai storie di successo o domande, condividile nei commenti. Buona domotica a tutti, e ricordati: la casa intelligente inizia con un piccolo passo!</p>

<h2>Manutenzione e Aggiornamenti della Domotica Lowcost</h2>
<p>La domotica lowcost richiede poca manutenzione, ma alcuni accorgimenti prolungano la vita dei dispositivi e garantiscono sicurezza. Ecco cosa fare:</p>
<ul>
<li><strong>Aggiornamenti firmware:</strong> Controlla regolarmente le app per aggiornamenti. I produttori rilasciano patch di sicurezza e nuove funzionalit√†.</li>
<li><strong>Controllo batterie:</strong> Per dispositivi a batteria, sostituisci quando necessario. Sensori come Aqara durano 2 anni.</li>
<li><strong>Pulizia:</strong> Pulisci telecamere e sensori da polvere per evitare malfunzionamenti.</li>
<li><strong>Backup configurazioni:</strong> Salva le impostazioni delle app per ripristini rapidi.</li>
</ul>
<p>Una manutenzione regolare previene problemi e mantiene il sistema efficiente. Dedica 10 minuti al mese per controlli.</p>
<p>Se un dispositivo si guasta, molti brand offrono garanzia. Shelly e Sonoff hanno supporto clienti reattivo. Non esitare a contattarli per assistenza.</p>
</section>


<div class="footer" style="opacity:.8;margin:28px 0">
<p>Demo offline con il tuo tema. Sostituisci i link con i tuoi deeplink affiliati. In qualit√† di Affiliato Amazon, potrei ricevere un compenso dagli acquisti idonei.</p>
<p><a href="privacy.html">Privacy</a> ¬∑ <a href="cookie.html">Cookie</a> ¬∑ <a href="termini.html">Termini</a></p>
</div>
</main>

<script>

/* ========= Utils ========= */
const qs = s => document.querySelector(s);
const qsa = s => [...document.querySelectorAll(s)];
const ce = (t,cls) => Object.assign(document.createElement(t), cls?{className:cls}:{});
const fmtEur = n => new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(n);

/* ========= Categorie ========= */
const CAT_LABELS = {
  all: "Tutte",
  casa_cucina: "Casa e Cucina",
  animali: "Prodotti per Animali",
  bellezza: "Bellezza & Cura Persona",
  fai_da_te: "Fai da Te e Giardinaggio",
  infanzia: "Prodotti per l'Infanzia"
};
const catLabel = k => CAT_LABELS[k] || k;

/* ========= Demo data ========= */
const AMAZON_TAG="YOUR_TAG-21";
const DEALS=[
  { id:"d1", title:"Friggitrice ad Aria 5.5L", desc:"Cestello antiaderente, 8 programmi, facile da pulire. Ideale per porzioni familiari con minore olio.", rating:4.6, reviews:3560, cat:"casa_cucina", store:"Amazon", merchant:"amazon", priceNow:89, priceWas:139, discount:36, coupon:"AIR10", image:"https://images.unsplash.com/photo-1606756790138-261c7d3113b9?q=80&w=1200&auto=format&fit=crop", history:[139,129,119,99,89], addedAt:"2025-08-05", links:{ amazon:"https://www.amazon.it/dp/B08XYZXYZ" , gallery:['https://images.unsplash.com/photo-1606756790138-261c7d3113b9?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1543352634-8730a9b43ae4?q=80&w=1200&auto=format&fit=crop'], pros:['Cuoce in modo uniforme','Cestello grande per famiglia','Facile da pulire','Programmi essenziali, non troppi'], cons:['Ingombro sul piano cucina','Nessuna app/ricette integrate','Rumore ventola udibile a piena potenza'], specs:[['Capienza','5.5 L'],['Potenza','1700 W'],['Lavastoviglie','Cestello s√¨'],['Programmi','8'],['Garanzia','2 anni']], longDesc:`Abbiamo cucinato patate, pollo e verdure per pi√π giorni: la resa √® stata costante, con doratura uniforme senza odori forti. Non √® un modello ‚Äúsmart‚Äù: per molti √® un pro (meno complessit√†), per chi vuole app/appunti √® un contro. Dopo 2 settimane di uso, il rivestimento √® ancora perfetto. Consigliata a chi vuole qualit√† senza spendere troppo.`} },
  { id:"d2", title:"Cibo Secco Premium per Cani 12kg", desc:"Ricco di proteine con ingredienti dichiarati, senza coloranti. Sacco richiudibile anti-odore.", rating:4.7, reviews:1420, cat:"animali", store:"Zooplus", merchant:"awin", priceNow:39, priceWas:59, discount:34, coupon:"DOG5", image:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop", history:[59,55,49,45,39], addedAt:"2025-08-06", links:{ awin:"https://www.awin1.com/cread.php?awinmid=222&awinaffid=333" , gallery:['https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1612539927811-2b18a6c41f5e?q=80&w=1200&auto=format&fit=crop'], pros:['Buona tollerabilit√†','Rapporto qualit√†/prezzo','Sacco richiudibile comodo'], cons:['Crocche non adatte a cani molto piccoli','Nessuna variante grain-free','Odore intenso all‚Äôapertura'], specs:[['Formato','12 kg'],['Proteine','24%'],['Conservazione','Sacco richiudibile'],['Origine','UE']], longDesc:`Provato su due cani (taglia media): feci regolari e pelo lucido dopo 10 giorni. Non √® super premium, ma in promo √® un ottimo compromesso. Se il tuo cane √® sensibile ai cereali, valuta alternative grain-free.`} },
  { id:"d3", title:"Siero Viso Acido Ialuronico 60ml", desc:"Texture leggera, ad assorbimento rapido. Ingredienti essenziali, adatto a tutti i tipi di pelle.", rating:4.4, reviews:2300, cat:"bellezza", store:"Amazon", merchant:"amazon", priceNow:12, priceWas:19, discount:37, coupon:null, image:"https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop", history:[19,17,15,13,12], addedAt:"2025-08-08", links:{ amazon:"https://www.amazon.it/dp/B0AAABBBB" , gallery:['https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1545239351-1141bd82e8a6?q=80&w=1200&auto=format&fit=crop'], pros:['Texture leggera','INCI essenziale','Ottimo sotto il make-up'], cons:['Flacone senza contagocce di qualit√†','Profumo leggero non per tutti'], specs:[['Contenuto','60 ml'],['Attivo','Acido Ialuronico'],['Profumo','Leggero'],['Pelli','Tutte']], longDesc:`Usato mattina e sera per due settimane: pelle pi√π elastica, senza pilling con la crema solare. Non aspettarti miracoli anti-et√†: √® idratazione onesta a prezzo corretto.`} },
  { id:"d4", title:"Trapano Avvitatore 18V con Accessori", desc:"Coppia regolabile, luce LED e set punte incluso. Valigetta rigida per riporre tutto.", rating:4.5, reviews:980, cat:"fai_da_te", store:"Leroy Merlin", merchant:"tradedoubler", priceNow:69, priceWas:99, discount:30, coupon:null, image:"https://images.unsplash.com/photo-1504148455329-4ff0802cfb7e?q=80&w=1200&auto=format&fit=crop", history:[99,92,85,79,69], addedAt:"2025-07-30", links:{ tradedoubler:"https://clk.tradedoubler.com/click?p=333&a=444" , gallery:['https://images.unsplash.com/photo-1504148455329-4ff0802cfb7e?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1511207538754-e855bd8f15a5?q=80&w=1200&auto=format&fit=crop'], pros:['Buona coppia per lavori leggeri','Valigetta con accessori','Luce LED utile in spazi stretti'], cons:['Non adatto a muratura impegnativa','Mandrino con lieve gioco','Batteria singola in confezione base'], specs:[['Voltaggio','18 V'],['Modalit√†','Trapano/Avvitatore'],['Accessori','S√¨'],['Luce','LED']], longDesc:`Perfetto per casa: mensole, piccoli montaggi, riparazioni. Per fori importanti nel cemento serve altro. Il LED fa la differenza in armadi e nicchie.`} },
  { id:"d5", title:"Passeggino Leggero Pieghevole", desc:"Telaio in alluminio, schienale reclinabile e chiusura con una mano. Omologato fino a 15 kg.", rating:4.6, reviews:640, cat:"infanzia", store:"Amazon", merchant:"amazon", priceNow:99, priceWas:159, discount:38, coupon:"BABY10", image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?q=80&w=1200&auto=format&fit=crop", history:[159,149,129,119,99], addedAt:"2025-08-04", links:{ amazon:"https://www.amazon.it/dp/B0CCCCCCC" , gallery:['https://images.unsplash.com/photo-1631049307264-da0ec9d70304?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1595433707802-6b2626ef1c86?q=80&w=1200&auto=format&fit=crop'], pros:['Si chiude con una mano','Molto leggero','Tessuti facili da pulire'], cons:['Cesto sottosedile non enorme','Ruote piccole su sanpietrini','Colori limitati'], specs:[['Peso','6.9 kg'],['Omologazione','fino 15 kg'],['Chiusura','One-hand'],['Accessori','Parapioggia']], longDesc:`Provato su marciapiedi e mezzi pubblici: maneggevole e stabile. Non √® un fuoristrada, ma per citt√† va benissimo. Seduta comoda, cinture rapide.`} },
  { id:"d6", title:"Set Pentole Acciaio 10 pz", desc:"Fondo adatto a induzione, manici isolanti e coperchi in vetro. Lavabile in lavastoviglie.", rating:4.5, reviews:620, cat:"casa_cucina", store:"Amazon", merchant:"amazon", priceNow:99, priceWas:149, discount:34, coupon:null, image:"https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop", history:[149,139,129,119,99], addedAt:"2025-08-01", links:{ amazon:"https://www.amazon.it/dp/B0DDDDEEEE" , gallery:['https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1485968579580-b6d095142e6e?q=80&w=1200&auto=format&fit=crop'], pros:['Fondo a sandwich per induzione','Coperchi in vetro con sfiato','Impilabili e lavabili'], cons:['Manici che scaldano a fiamma alta','Niente scala interna di misure'], specs:[['Pezzi','10'],['Materiale','Acciaio'],['Lavastoviglie','S√¨'],['Compatibilit√†','Induzione']], longDesc:`Qualit√† solida per uso quotidiano. Non antiaderenti: serve un filo d‚Äôolio in pi√π ma durano nel tempo. In promo diventano un best buy.`} },
  { id:"d7", title:"Tosaerba Elettrico 1400W", desc:"Larghezza taglio 32 cm, raccolta 30 L, regolazione altezza in 3 posizioni. Perfetto per giardini piccoli.", rating:4.2, reviews:510, cat:"fai_da_te", store:"Amazon", merchant:"amazon", priceNow:119, priceWas:179, discount:34, coupon:null, image:"https://images.unsplash.com/photo-1523419410227-deebaa99fd0f?q=80&w=1200&auto=format&fit=crop", history:[179,169,149,139,119], addedAt:"2025-07-25", links:{ amazon:"https://www.amazon.it/dp/B0FFFFGGGG" , gallery:['https://images.unsplash.com/photo-1523419410227-deebaa99fd0f?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1562599938-7208977f7baf?q=80&w=1200&auto=format&fit=crop'], pros:['Leggero e facile da spingere','Raccolta sufficiente per 200 m¬≤','Regolazione altezza rapida'], cons:['Cavo da gestire (non √® a batteria)','Rumore nella media','Scocca non metallica'], specs:[['Potenza','1400 W'],['Larghezza taglio','32 cm'],['Cesto','30 L'],['Terreno','fino 250 m¬≤']], longDesc:`Se hai un giardino piccolo/medio fa il suo, senza spese di batterie. Lame sostituibili facili da trovare. Attenzione a cavi e prolunghe di qualit√†.`} },
  { id:"d8", title:"Cuccia Morbida per Gatti L", desc:"Interno in peluche, fondo antiscivolo e cuscino estraibile. Lavabile in lavatrice 30¬∞.", rating:4.5, reviews:880, cat:"animali", store:"Amazon", merchant:"amazon", priceNow:25, priceWas:39, discount:36, coupon:null, image:"https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop", history:[39,35,32,29,25], addedAt:"2025-08-02", links:{ amazon:"https://www.amazon.it/dp/B0HHHHIIII" , gallery:['https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1573865526739-10659fec78a5?q=80&w=1200&auto=format&fit=crop'], pros:['Morbida e avvolgente','Fondo antiscivolo','Cuscino estraibile'], cons:['Taglia L stretta per gatti XXL','Colore chiaro si sporca facilmente'], specs:[['Taglia','L'],['Lavaggio','30¬∞'],['Fondo','Antiscivolo'],['Uso','Interno']], longDesc:`I gatti ci saltano dentro in pochi minuti (testato con 2 mici redattori). Calda, stabile, zero odore chimico al primo uso.`} }
];
const GUIDES=[
  {id:"g1", title:"Come risparmiare davvero online (senza fregature)", excerpt:"Metodo, non fortuna: budget, preferiti e storico prezzi.", body:`
    <p>Risparmiare non √® questione di ‚Äúcolpo di fortuna‚Äù, ma di <b>metodo</b>. La prima regola √® stabilire un <b>budget</b> e rispettarlo: quando vedi un -40% √® facile lasciarsi prendere, ma se quel prezzo ‚Äúpieno‚Äù non esiste mai, lo sconto non √® reale. Per questo su Offerteshock guardiamo lo <b>storico</b> dei prezzi e segnaliamo solo cali che hanno senso.</p>
    <p>Secondo: usa i <b>Preferiti</b>. Aggiungi i prodotti che ti interessano e lascia che sia il sistema ad avvisarti quando scendono davvero. Terzo: i <b>coupon intelligenti</b>. Alcuni si sommano allo sconto in pagina (stack), altri richiedono login al negozio. Vale sempre la pena provare.</p>
    <p>Errori comuni? Comprare ‚Äúperch√© √® in offerta‚Äù, rincorrere modelli vecchi solo per il prezzo, sottovalutare i costi di reso. La nostra <b>checklist</b>: 1) ho davvero bisogno di questo? 2) √® il <i>prezzo pi√π basso degli ultimi mesi</i>? 3) la qualit√† √® coerente con l‚Äôuso che ne far√≤? Se le risposte sono s√¨, √® un buon affare.</p>`},
  {id:"g2", title:"Guida pratica all‚Äôacquisto su Amazon con affiliazione", excerpt:"Prezzo uguale per te, piccola commissione per noi (trasparente).", body:`
    <p>Quando clicchi un nostro link affiliato verso Amazon, <b>il prezzo per te non cambia</b>. Se concludi un acquisto idoneo, Amazon riconosce una piccola commissione a Offerteshock: √® il modo con cui manteniamo contenuti gratuiti e indipendenti.</p>
    <p>Noi selezioniamo le offerte con gli stessi criteri che useremmo per noi: niente ‚Äúspinte‚Äù sponsor, niente favoritismi. Se un prodotto non ci convince, lo scriviamo. In pagina trovi sempre <b>pro e contro</b>, alternative e un‚Äôindicazione onesta su chi dovrebbe comprarlo e chi no.</p>
    <p>Consiglio pratico: aggiungi ai Preferiti i modelli che ti interessano e aspetta un calo significativo. Spesso basta <b>qualche giorno</b> per vedere -10/-20% in periodi strategici (fine mese, weekend lunghi, eventi). Comprare bene √® una maratona, non uno sprint.</p>`},
  {id:"g3", title:"Friggitrice ad aria: come scegliere quella giusta", excerpt:"Capienza reale, watt, programmi utili e pulizia.", body:`
    <p>La domanda numero uno: <b>capienza</b>. Per 1‚Äì2 persone bastano 4‚Äì5 L; famiglie 3‚Äì4 persone meglio 5,5‚Äì7 L; oltre, considera i modelli ‚Äúduo‚Äù con doppio cestello. I <b>watt</b> contano per tempi rapidi e doratura uniforme (1.500‚Äì1.800 W sono uno sweet spot).</p>
    <p>Programmi? Meglio pochi ma utili: patatine, pollo, verdure coprono il 90% dei casi. Valuta materiali (cestello antiaderente resistente, parti lavabili in lavastoviglie), <b>rumorosit√†</b> e ingombro sul piano cucina. Diffida delle promesse miracolose: la differenza reale la fanno uniformit√† di cottura e facilit√† di pulizia.</p>
    <p>Pro tip: se mangi spesso per pi√π persone, il <b>doppio cestello</b> evita ‚Äúondate‚Äù di cottura e ti fa davvero risparmiare tempo.</p>`},
  {id:"g4", title:"Cura del prato in 30 minuti a settimana", excerpt:"Routine semplice, attrezzi giusti, stagionalit√†.", body:`
    <p>Per un prato in ordine non serve passare i weekend al tagliaerba. Bastano <b>30 minuti</b> a settimana con una routine costante: taglio leggero (mai pi√π di 1/3 dell‚Äôaltezza), rifinitura dei bordi e controllo rapido di erbacce e zone ingiallite. In estate alza l‚Äôaltezza di taglio (5‚Äì6 cm) per proteggere l‚Äôerba dal caldo.</p>
    <p>Attrezzi minimi: rasaerba affidabile, rifilabordi, rastrello. Se innaffi, fallo al mattino presto 2‚Äì3 volte a settimana, evitando ristagni. In primavera valuta un <b>carotaggio</b> leggero per arieggiare e in autunno una concimazione ‚Äúlenta‚Äù per preparare l‚Äôinverno.</p>
    <p>Ricorda: regolarit√† > intensit√†. Poco e spesso vince sempre.</p>`},
  {id:"g5", title:"Beauty routine semplice (3 prodotti, zero sprechi)", excerpt:"Detersione, siero, crema con SPF. Fine.", body:`
    <p>La miglior routine √® quella che <b>riesci a mantenere</b>. Partiamo da tre pilastri: detersione delicata, siero mirato (es. ialuronico per idratazione) e crema con <b>SPF</b> la mattina. Per pelli grasse aggiungi un attivo come niacinamide; per quelle secche scegli texture pi√π ricche. Leggi INCI con buon senso: pochi ingredienti chiari valgono pi√π di buzzword rumorose.</p>
    <p>Evita di introdurre cinque novit√† insieme: testa un prodotto per volta e fai un <b>patch test</b> se hai pelle reattiva. Ricorda che costoso non significa sempre migliore: presta attenzione a formulazione, confezione e esperienza d‚Äôuso.</p>`},
  {id:"g6", title:"Passeggino: cosa conta davvero", excerpt:"Peso, chiusura, ruote e certificazioni.", body:`
    <p>Se vivi in citt√† (scale, mezzi pubblici), il <b>peso</b> e la <b>chiusura con una mano</b> fanno la differenza. Le ruote grandi aiutano su sanpietrini o sterrato leggero; una cappottina profonda con protezione UV √® pi√π utile di tanti accessori ‚Äúgadget‚Äù.</p>
    <p>Valuta <b>reclinazione</b> e compatibilit√† con navicella/ovetto. Verifica le certificazioni e i limiti di peso, e pensa alla <b>pulizia</b>: rivestimenti sfoderabili ti salvano tempo (e nervi). Accessori da considerare: parapioggia, coprigambe, borsa capiente. Non inseguire il top di gamma: meglio un buon compromesso che userai davvero.</p>`}
];
const POSTS=[
  {id:"p1", title:"Top 10 offerte Casa & Cucina di oggi", date:"2025-08-11", body:`
    <p>Ogni giorno selezioniamo a mano le offerte ‚Äúche prenderemmo anche noi‚Äù. Niente finti sconti, niente corse al ribasso su prodotti scarsi. Guardiamo lo <b>storico</b> dei prezzi, il rapporto qualit√†/prezzo e l‚Äôutilit√† nella vita di tutti i giorni. Se un set di pentole ha bordi sottili che deformano, lo scartiamo; se un robot pulisce bene ma si incastra sui tappeti, lo diciamo. La lista cambia spesso: salva tra i <b>Preferiti</b> i prodotti che ti interessano e lascia che sia il prezzo a venire da te.</p>`},
  {id:"p2", title:"Animali: risparmiare senza rinunciare alla qualit√†", date:"2025-08-11", body:`
    <p>Con cani e gatti i soldi volano, ma si pu√≤ risparmiare con buon senso. Controlla <b>ingredienti</b> e formato: i sacchi grandi costano meno al kg, ma solo se li consumi prima che perdano freschezza. Occhio alle promo ricorrenti su cibo premium: spesso tornano a fine mese. Valuta abbonamenti flessibili (si sospendono quando vuoi) e usa i <b>Preferiti</b> per tracciare il tuo brand preferito: quando scende, ti avvisiamo noi.</p>`},
  {id:"p3", title:"Bellezza: pochi prodotti, risultati concreti", date:"2025-08-11", body:`
    <p>La routine perfetta non esiste; esiste quella che funziona per te. Noi puntiamo su pochi prodotti ben formulati: detergente delicato, siero mirato, crema con SPF. Evitiamo pack esagerati e promesse lunaresche. Se un prodotto √® ottimo ma caro, suggeriamo <b>alternative equivalenti</b>. E se costa poco ma funziona, lo diciamo a gran voce. L‚Äôobiettivo non √® riempire il bagno, ma far rendere il budget.</p>`},
  {id:"p4", title:"Fai da te & Giardino: strumenti che durano", date:"2025-08-11", body:`
    <p>Comprare male √® comprare due volte. Preferiamo attrezzi con <b>ricambi disponibili</b>, assistenza decente e un po‚Äô di sovradimensionamento: un trapano che non si surriscalda e un rasaerba che non si ferma a met√† prato sono soldi risparmiati. Nei nostri consigli trovi pro e contro chiari, perch√© ogni casa e ogni mano sono diverse: meglio scegliere bene che inseguire la promo del giorno.</p>`},
  {id:"p5", title:"Infanzia: sicurezza e praticit√† prima di tutto", date:"2025-08-11", body:`
    <p>Quando si parla di bambini, la priorit√† √® doppia: <b>sicurezza</b> e praticit√†. Per i passeggini contano ruote, telaio e facilit√† di chiusura; per seggiolini auto e navicelle informati sempre sulle norme aggiornate e sulle compatibilit√† con la tua auto. Noi selezioniamo prodotti che semplificano la vita: lavabili, robusti, ben progettati. E se il colore non √® quello ‚Äúdi moda‚Äù, pazienza: il comfort vince.</p>`}
];

/* ========= Stato ========= */
const FAV_KEY='os_fav_v11'; let FAVS=new Set(JSON.parse(localStorage.getItem(FAV_KEY)||'[]'));
let QUERY=''; let SORT='best'; let CAT='all';

/* ========= Helpers UI ========= */
function stars(n){ const full=Math.floor(n); const half=(n-full)>=0.5 ? 1 : 0; return '‚òÖ'.repeat(full)+ (half?'¬Ω':'') + '<span style="opacity:.4">'+ '‚òÖ'.repeat(5-full-half)+'</span>'; }
function spark(history){
  const w=260,h=32,p=6,min=Math.min(...history),max=Math.max(...history);
  const sx=i=>p+(i*(w-2*p)/(history.length-1)), sy=v=>p+(h-2*p)-(((v-min)/(max-min||1))*(h-2*p));
  let d=""; history.forEach((v,i)=> d+=(i?'L':'M')+sx(i)+' '+sy(v)+' ');
  const last=history.at(-1), first=history[0], col= last<first?'#22c55e':'#eab308';
  return `<svg width="${w}" height="${h}" role="img" aria-label="Andamento prezzo"><path d="${d}" fill="none" stroke="${col}" stroke-width="2"/></svg>`;
}
function badge(o){
  if(o.discount>=60) return `<div class="badge errore">‚ö° Probabile errore di prezzo</div>`;
  if(o.discount>=45) return `<div class="badge bomba">üî• Offerta bomba</div>`;
  if(o.priceWas && o.priceNow && o.priceNow<o.priceWas) return `<div class="badge">Risparmia ${fmtEur(o.priceWas - o.priceNow)}</div>`;
  return '';
}
function aff(url, merchant, id){
  const sub = "DEMO_"+id;
  try{
    if(merchant==='amazon'){ const u=new URL(url); if(!u.searchParams.get('tag')) u.searchParams.set('tag', AMAZON_TAG); u.searchParams.set('ascsubtag', sub); return u.toString(); }
    if(merchant==='awin'){ return url + (url.includes('?')?'&':'?') + 'clickref=' + encodeURIComponent(sub); }
    if(merchant==='tradedoubler'){ return url + (url.includes('?')?'&':'?') + 'epi=' + encodeURIComponent(sub); }
  }catch(e){}
  return url;
}
function card(o){
  const fav=FAVS.has(o.id);
  const url = Object.values(o.links)[0] || '#';
  return `<article class="card" data-id="${o.id}">
    ${badge(o)}
    <button class="fav-btn ${fav?'active':''}" data-fav="${o.id}" aria-pressed="${fav}" aria-label="Aggiungi ai preferiti">‚ù§Ô∏è</button>
    <img src="${o.image}" alt="${o.title}">
    <div class="content">
      <div class="title">${o.title}</div>${o.desc?`<p class="desc">${o.desc}</p>`:""}
      <div class="stars">${stars(o.rating)} <span style="opacity:.7">(${o.reviews.toLocaleString('it-IT')})</span></div>
      <div class="price"><span class="now">${fmtEur(o.priceNow)}</span> <span class="was">${fmtEur(o.priceWas)}</span> <span class="discount">-${o.discount}%</span></div>
      <div class="tags"><span class="tag">Store: ${o.store}</span><span class="tag">Cat: ${catLabel(o.cat)}</span></div>
      ${spark(o.history)}
      <div class="cta">
        <a class="btn primary" href="${aff(url, o.merchant, o.id)}" target="_blank" rel="nofollow sponsored">Vai all‚Äôofferta</a>
        <button class="btn" data-detail="${o.id}">Dettagli</button>
      </div>
      <div class="cta">
        ${o.coupon?`<span class="coupon-chip">Coupon <code>${o.coupon}</code> <button class="btn btn-copy" data-copy="${o.coupon}">Copia</button><span class="copy-ok">‚úì Copiato</span></span>`:''}
        <button class="btn" data-share="${o.id}">Condividi</button>
      </div>
    </div>
  </article>`;
}

/* ========= Ordinamento e filtri ========= */
const cmp = {
  best: (a,b)=> (b.discount + b.rating/5) - (a.discount + a.rating/5),
  discount_desc: (a,b)=> b.discount - a.discount,
  price_asc: (a,b)=> a.priceNow - b.priceNow,
  price_desc:(a,b)=> b.priceNow - a.priceNow,
  reviews_desc:(a,b)=> b.reviews - a.reviews,
  new_desc:(a,b)=> new Date(b.addedAt) - new Date(a.addedAt),
};
function filtered(){
  let res = DEALS.slice();
  if(CAT!=='all') res = res.filter(o => o.cat===CAT);
  if(QUERY){ const t=QUERY.toLowerCase(); res = res.filter(o=> o.title.toLowerCase().includes(t)); }
  res.sort(cmp[SORT] || cmp.best);
  return res;
}
function syncControls(){
  const sc = qs('#sortCompact'), cat = qs('#catSelect');
  if(sc) sc.value = SORT;
  if(cat) cat.value = CAT;
}

/* ========= Render ========= */
function render(){
  const list = filtered();
  qs('#hero').innerHTML = list.slice(0,2).map(card).join('');
  qs('#tops').innerHTML = list.slice(2,5).map(card).join('');
  qs('#grid').innerHTML = list.map(card).join('');
  qs('#resultsCount').textContent = `${list.length} risultati`;
  qsa('.fav-btn').forEach(b => { const id=b.dataset.fav; b.classList.toggle('active', FAVS.has(id)); b.setAttribute('aria-pressed', b.classList.contains('active')); });
  buildTicker(list);
  syncControls();
}
function buildTicker(list){
  const best = list.slice().sort(cmp.discount_desc).slice(0,8);
  const items = best.map(o=> `<span class="tick">üî• <b>-${o.discount}%</b> ${o.title} ¬∑ <a href="${aff(Object.values(o.links)[0]||'#', o.merchant, o.id)}" target="_blank" rel="nofollow sponsored">Vai</a></span>`).join('');
  const html = items + items;
  const track = qs('#tickerTrack');
  if(track){ track.innerHTML = html; }
}

/* ========= Interazioni card ========= */
document.addEventListener('click', (e)=>{
  const fav = e.target.closest('.fav-btn');
  if(fav){
    const id = fav.dataset.fav;
    if(FAVS.has(id)) FAVS.delete(id); else FAVS.add(id);
    localStorage.setItem(FAV_KEY, JSON.stringify([...FAVS]));
    fav.classList.toggle('active'); fav.setAttribute('aria-pressed', fav.classList.contains('active'));
    qs('#favCount').textContent = FAVS.size;
    return;
  }
  const cp = e.target.closest('[data-copy]');
  if(cp){
    const code = cp.getAttribute('data-copy');
    navigator.clipboard.writeText(code).then(()=>{
      const ok = cp.parentElement.querySelector('.copy-ok'); if(ok){ ok.classList.add('show'); setTimeout(()=>ok.classList.remove('show'), 1200); }
    });
    return;
  }
  const det = e.target.closest('[data-detail]');
  if(det){
    const o = DEALS.find(x=> x.id===det.getAttribute('data-detail'));
    if(o) openArticle(`<h3>${o.title}</h3><p>Dettagli sull'offerta (demo)</p>${spark(o.history)}`);
    return;
  }
  const share = e.target.closest('[data-share]');
  if(share){
    const o = DEALS.find(x=> x.id===share.getAttribute('data-share'));
    if(navigator.share){ navigator.share({title:o.title, text:'Guarda questa offerta', url:location.href}).catch(()=>{}); }
    else { alert('Copia il link dalla barra degli indirizzi.'); }
    return;
  }
});

/* ========= Ricerca + suggerimenti ========= */
const SKEY='recentSearches_v6';
function loadRecent(){ return JSON.parse(localStorage.getItem(SKEY) || '[]'); }
function saveRecent(arr){ localStorage.setItem(SKEY, JSON.stringify(arr.slice(0,8))); }
function addRecent(term){
  term = term.trim().toLowerCase();
  if(!term) return;
  const list = loadRecent().filter(x=>x!==term);
  list.unshift(term); saveRecent(list);
}
function openSuggest(anchor){
  const list = loadRecent();
  const box = getSuggest();
  if(!list.length){ box.style.display='none'; return; }
  box.innerHTML = `<div class="head">Ricerche recenti</div>` + list.map(t=>`<div class="sugg-item" data-term="${t}">${t}</div>`).join('');
  const r = anchor.getBoundingClientRect();
  box.style.left = Math.max(8, r.left) + 'px';
  box.style.top  = (r.bottom + 6) + 'px';
  box.style.width = Math.min(360, Math.max(220, r.width)) + 'px';
  box.style.display = 'block';
}
function closeSuggest(){ getSuggest().style.display='none'; }
function getSuggest(){ let b=qs('#suggest'); if(!b){ b=document.createElement('div'); b.id='suggest'; b.className='suggest'; document.body.appendChild(b);} return b; }
function doSearch(term){
  term = (term||'').trim();
  if(!term) return;
  QUERY = term;
  addRecent(term);
  closeSuggest();
  render();
}
qs('#q').addEventListener('focus', e=> openSuggest(e.target));
qs('#q').addEventListener('blur', ()=> setTimeout(closeSuggest, 120));
qs('#q').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); doSearch(qs('#q').value); }});
qs('#btnSearch').addEventListener('click', ()=> doSearch(qs('#q').value));
document.body.addEventListener('click', (e)=>{
  const it = e.target.closest('.sugg-item'); if(!it) return;
  const t = it.getAttribute('data-term'); qs('#q').value = t; doSearch(t);
});

/* ========= Burger Popover ========= */
const pop = qs('#popMenu'); const scrim = qs('#popScrim'); const burger = qs('#btnBurger');
function gutters(){
  const main = qs('main.container'); const vw = innerWidth;
  const rect = main ? main.getBoundingClientRect() : {left:12, right: vw-12};
  return { left: Math.max(0, rect.left), right: Math.max(0, vw - rect.right), vw };
}
function placePop(){
  const r = burger.getBoundingClientRect();
  const {left:gL, right:gR, vw} = gutters();
  pop.style.visibility='hidden'; pop.style.display='block';
  const pw = pop.offsetWidth, ph = pop.offsetHeight;
  pop.style.visibility='';
  const vh = innerHeight;
  const spaceBelow = vh - (r.bottom + 12);
  const openTop = spaceBelow < ph;
  const top = openTop ? (r.top - ph - 12) : (r.bottom + 12);
  const left = gL;
  pop.style.top = top + 'px'; pop.style.left = left + 'px';
  pop.style.maxWidth = Math.max(220, vw - gL - gR - 2) + 'px';
  const ox = (r.left + r.width/2) - left;
  pop.style.setProperty('--pop-ox', ox + 'px');
  pop.style.setProperty('--caret-x', (Math.min(pw-18, Math.max(12, ox)) - 6) + 'px');
  pop.style.setProperty('--caret-top', openTop ? (ph - 6) + 'px' : '-6px');
}
function openPop(){ placePop(); scrim.style.display='block'; pop.classList.add('open'); burger.setAttribute('aria-expanded','true'); }
function closePop(){ pop.classList.remove('open'); setTimeout(()=>{pop.style.display='none'; scrim.style.display='none';}, 220); burger.setAttribute('aria-expanded','false'); }
burger.addEventListener('click', ()=> pop.classList.contains('open')? closePop(): openPop());
scrim.addEventListener('click', closePop);
addEventListener('resize', ()=>{ if(pop.classList.contains('open')) placePop(); }, {passive:true});
addEventListener('scroll', ()=>{ if(pop.classList.contains('open')) placePop(); }, {passive:true});
// Handle device rotation: reopen automatically if it was open
addEventListener('orientationchange', ()=>{
  try{
    const wasOpen = pop.classList.contains('open');
    closePop();
    pop.style.removeProperty('top'); pop.style.removeProperty('left');
    if(wasOpen){ setTimeout(()=>{ openPop(); }, 420); }
  }catch(e){}
});
document.addEventListener('visibilitychange', ()=>{ if(document.hidden) closePop(); });
pop.addEventListener('click', (e)=>{
  const it = e.target.closest('.pop-item'); if(!it) return;
  const key = it.getAttribute('data-open');
  closePop();
  if(key==='home'){ SORT='best'; CAT='all'; QUERY=''; qs('#q').value=''; render(); return; }
  if(key==='guides'){ openList('m-guides', GUIDES, true); return; }
  if(key==='about'){ openModal('m-about'); return; }
  if(key==='blog'){ openList('m-blog', POSTS, false); return; }
  if(key==='favs'){ qs('#favToggle').click(); return; }
  if(key==='settings'){ openModal('m-settings'); return; }
  if(key==='privacy'){ openModal('m-privacy'); return; }
  if(key==='cookie'){ openModal('m-cookie'); return; }
  if(key==='tos'){ openModal('m-tos'); return; }
  if(key==='contact'){ openModal('m-contact'); return; }
});

/* ========= Modali + Liste ========= */
function openModal(id){ qs('#'+id).style.display='flex'; }
function closeAllModals(){ qsa('.modal').forEach(m=> m.style.display='none'); }
qsa('[data-close]').forEach(b=> b.addEventListener('click', closeAllModals));
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeAllModals(); });
function openArticle(html){ qs('#article').innerHTML = html; openModal('m-article'); }
function openList(id, items, isGuide){
  const tgt = qs('#'+id);
  const grid = tgt.querySelector(isGuide?'#guides':'#blog');
  grid.innerHTML = items.map(x=>`<article class="card" data-id="${x.id}">\n<button class="fav-btn ${FAVS.has(x.id)?'active':''}" data-fav="${x.id}" aria-pressed="${FAVS.has(x.id)}" aria-label="Aggiungi ai preferiti">‚ù§Ô∏è</button><img src="https://images.unsplash.com/photo-1542401886-65d6c61db817?q=80&w=1200&auto=format&fit=crop" alt="" style="width:100%;aspect-ratio:16/9;object-fit:cover"><div class="content"><div class="title">${x.title}</div><p style="color:var(--muted)">${isGuide?x.excerpt:('Pubblicato il '+x.date)}</p><div class="cta"><button class="btn" data-read="${x.id}">Leggi</button></div></div></article>`).join('');
  openModal(id);
}
document.body.addEventListener('click', (e)=>{
  const read = e.target.closest('[data-read]');
  if(read){
    const id = read.getAttribute('data-read');
    const g = GUIDES.find(x=>x.id===id) || POSTS.find(x=>x.id===id);
    if(g) openArticle(`<h3>${g.title}</h3>${g.body||'<p>...</p>'}`);
  }
});

/* ========= Auth demo + preferiti ========= */
qs('#favToggle').addEventListener('click', ()=>{
  const favs = DEALS.filter(o=> FAVS.has(o.id));
  const html = favs.length ? favs.map(o=>`<div class="card"><div class="content"><div class="title">${o.title}</div>${o.desc?`<p class="desc">${o.desc}</p>`:""}<div class="price"><span class="now">${fmtEur(o.priceNow)}</span></div><a class="btn primary" href="${aff(Object.values(o.links)[0]||'#', o.merchant, o.id)}" target="_blank" rel="nofollow sponsored">Vai</a></div></div>`).join('') : "<p>Nessun preferito.</p>";
  qs('#favs').innerHTML = html; openModal('m-favs');
});
qs('#btnLogin').addEventListener('click', ()=> openModal('m-login'));
qs('#btnRegister').addEventListener('click', ()=> openModal('m-register'));
qs('#btnLogout').addEventListener('click', ()=> alert('Logout demo'));
qs('#doLogin').addEventListener('click', ()=>{ alert('Login ok (demo)'); closeAllModals(); });
qs('#doRegister').addEventListener('click', ()=>{ alert('Registrazione ok (demo)'); closeAllModals(); });

/* ========= Controlli: sort + cat (solo in alto) ========= */
function setSort(v){ SORT=v; render(); }
function setCat(v){ CAT=v; render(); }
(()=>{ const el = qs('#sortCompact'); if(el) el.addEventListener('change', e=> setSort(e.target.value)); })();
(()=>{ const el = qs('#catSelect'); if(el) el.addEventListener('change', e=> setCat(e.target.value)); })();
/* ========= Init ========= */
qs('#favCount').textContent = FAVS.size;
render();

// Open detailed modal for a deal
function openDealDetails(dealId){
  const d = DEALS.find(x=>x.id===dealId);
  if(!d){ console.warn('Deal not found', dealId); return; }
  const el = document.getElementById('deal-detail');
  const stars = '‚òÖ'.repeat(Math.round(d.rating||0)) + '‚òÜ'.repeat(5-Math.round(d.rating||0));
  const couponBtn = d.coupon ? `<button class="btn ghost" data-copy="${d.coupon}" title="Copia coupon">${d.coupon}</button>` : '';
  const badgeList = [`${d.merchant?.toUpperCase()||'STORE'}`, d.discount?`-${d.discount}%`:'', d.reviews?`${d.reviews} recensioni`:'' ].filter(Boolean).map(b=>`<span class="badge">${b}</span>`).join('');
  const thumbs = (d.gallery||[d.image]).map((src,i)=>`<img src="${src}" alt="anteprima ${i+1}" data-main="${src}">`).join('');
  const specs = (d.specs||[]).map(s=>`<li><span>${s[0]}</span><span>${s[1]}</span></li>`).join('');
  const pros = (d.pros||[]).map(p=>`<li>‚úÖ ${p}</li>`).join('');
  const cons = (d.cons||[]).map(c=>`<li>‚ö†Ô∏è ${c}</li>`).join('');

  el.innerHTML = `
    <div class="deal-head">
      <div style="flex:1">
        <h4 class="deal-title">${d.title}</h4>
        <div class="deal-meta">${stars} <span>¬∑</span> <span>${d.rating?.toFixed?d.rating.toFixed(1):d.rating || 'N.D.'} / 5</span> <span>¬∑</span> <span>${d.reviews||0} recensioni</span></div>
        <div class="deal-price"><span class="now">‚Ç¨${d.priceNow?.toFixed?d.priceNow.toFixed(2):d.priceNow}</span>${d.priceWas?`<span class="was">‚Ç¨${d.priceWas}</span>`:''}</div>
        <div class="deal-actions">
          <a class="btn primary" href="${(d.links&& (d.links.amazon||d.links.awin||d.links.tradedoubler)) || '#'}" target="_blank" rel="nofollow noopener">Vedi su ${d.store||'negozio'}</a>
          ${couponBtn}
          <button class="btn ghost" data-fav="${d.id}">‚ù§Ô∏è Preferito</button>
          <button class="btn ghost" data-share="${d.id}">Condividi</button>
        </div>
        <div class="badges" style="margin-top:8px">${badgeList}</div>
      </div>
    </div>

    <div class="detail-grid">
      <div class="gallery">
        <img class="main-img" src="${(d.gallery&&d.gallery[0]) || d.image}" alt="${d.title}" id="detail-main">
        <div class="thumbs">${thumbs}</div>
      </div>
      <div class="specs">
        <h4>Specifiche essenziali</h4>
        <ul>${specs || '<li>Dati in aggiornamento</li>'}</ul>
        <div class="longdesc" style="margin-top:10px">${d.longDesc || d.desc || ''}</div>
        <div class="pros-cons">
          <div class="box pros"><h5>Pro</h5><ul>${pros||'<li>-</li>'}</ul></div>
          <div class="box cons"><h5>Contro</h5><ul>${cons||'<li>-</li>'}</ul></div>
        </div>
        <p class="disclosure">Trasparenza: potremmo ricevere una piccola commissione dagli acquisti idonei. Il prezzo per te non cambia.</p>
      </div>
    </div>
  `;

  // Thumbs interaction
  el.querySelectorAll('.thumbs img').forEach(img=>{
    img.addEventListener('click', ()=>{
      const main = el.querySelector('#detail-main');
      main.src = img.getAttribute('data-main');
    });
  });

  // Copy coupon
  el.querySelectorAll('[data-copy]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(btn.getAttribute('data-copy')); btn.textContent='Copiato!'; setTimeout(()=>btn.textContent=d.coupon, 1600); }catch(e){ alert('Copia non supportata'); }
    });
  });

  // Favorite
  el.querySelectorAll('[data-fav]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      toggleFavorite(d.id);
      btn.textContent = isFavorite(d.id) ? '‚ù§Ô∏è Nei preferiti' : '‚ù§Ô∏è Preferito';
    });
  });

  // Share (fallback)
  el.querySelectorAll('[data-share]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const shareData = { title: d.title, text: d.title, url: (d.links&& (d.links.amazon||d.links.awin||d.links.tradedoubler)) || location.href };
      if(navigator.share){ try{ await navigator.share(shareData); }catch(e){} }
      else{ await navigator.clipboard.writeText(shareData.url); btn.textContent='Link copiato'; setTimeout(()=>btn.textContent='Condividi',1400); }
    });
  });

  openModal('m-deal');
}


// Delegated: open details from cards
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('.btn-details');
  if(btn){ e.preventDefault(); openDealDetails(btn.getAttribute('data-id')); }
  const imgCard = e.target.closest('.card')?.querySelector('img');
  // Optionally: click on image opens details
  if(e.target.tagName==='IMG' && e.target.closest('.card')){
    const id = e.target.closest('.card').getAttribute('data-id');
    if(id){ openDealDetails(id); }
  }
});


</script>
<script>
(function(){
  if (window.__GLOBAL_HEADER_INIT__) return; window.__GLOBAL_HEADER_INIT__ = true;

  // Utils identical for all pages
  const qs = s => document.querySelector(s);
  const qsa = s => [...document.querySelectorAll(s)];
  const nf = new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR',maximumFractionDigits:0});

  // Burger (same placement logic as home)
  function placePop(burger, pop) {
    try{
      const r = burger.getBoundingClientRect();
      const vw = Math.max(document.documentElement.clientWidth, window.innerWidth||0);
      const ph = pop.offsetHeight || 260, pw = pop.offsetWidth || 260;
      const gL = 12, gR = 12;
      const vh = window.innerHeight || document.documentElement.clientHeight;
      const spaceBelow = vh - (r.bottom + 12);
      const openTop = spaceBelow < ph;
      const top = openTop ? (r.top - ph - 12) : (r.bottom + 12);
      const left = Math.max(gL, Math.min(vw - gR - pw, r.left + r.width/2 - pw/2));
      pop.style.top = top + 'px'; pop.style.left = left + 'px';
      pop.style.maxWidth = Math.max(220, vw - gL - gR - 2) + 'px';
      const ox = (r.left + r.width/2) - left;
      pop.style.setProperty('--pop-ox', ox + 'px');
      pop.style.setProperty('--caret-x', (Math.min(pw-18, Math.max(12, ox)) - 6) + 'px');
      pop.style.setProperty('--caret-top', openTop ? (ph - 6) + 'px' : '-6px');
    }catch(e){}
  }
  function bindBurger(){
    const burger = qs('#btnBurger'), pop = qs('#popMenu'), scrim = qs('#popScrim');
    if(!burger || !pop || !scrim) return;
    function openPop(){ placePop(burger, pop); scrim.style.display='block'; pop.classList.add('open'); burger.setAttribute('aria-expanded','true'); }
    function closePop(){ pop.classList.remove('open'); setTimeout(()=>{scrim.style.display='none';},200); burger.setAttribute('aria-expanded','false'); }
    burger.addEventListener('click', (e)=>{ e.preventDefault(); if(pop.classList.contains('open')) closePop(); else openPop(); });
    scrim.addEventListener('click', closePop);
    window.addEventListener('resize', ()=>{ if(pop.classList.contains('open')) placePop(burger, pop); }, {passive:true});
    window.addEventListener('scroll', ()=>{ if(pop.classList.contains('open')) placePop(burger, pop); }, {passive:true});
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePop(); });
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) pop.classList.remove('open'); });
  }

  // Ticker identical placement: just below the search in header
  function getDeals(){ 
    if (Array.isArray(window.DEALS)) return window.DEALS;
    try { window.DEALS = [
  { id:"d1", title:"Friggitrice ad Aria 5.5L", desc:"Cestello antiaderente, 8 programmi, facile da pulire. Ideale per porzioni familiari con minore olio.", rating:4.6, reviews:3560, cat:"casa_cucina", store:"Amazon", merchant:"amazon", priceNow:89, priceWas:139, discount:36, coupon:"AIR10", image:"https://images.unsplash.com/photo-1606756790138-261c7d3113b9?q=80&w=1200&auto=format&fit=crop", history:[139,129,119,99,89], addedAt:"2025-08-05", links:{ amazon:"https://www.amazon.it/dp/B08XYZXYZ" , gallery:['https://images.unsplash.com/photo-1606756790138-261c7d3113b9?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1543352634-8730a9b43ae4?q=80&w=1200&auto=format&fit=crop'], pros:['Cuoce in modo uniforme','Cestello grande per famiglia','Facile da pulire','Programmi essenziali, non troppi'], cons:['Ingombro sul piano cucina','Nessuna app/ricette integrate','Rumore ventola udibile a piena potenza'], specs:[['Capienza','5.5 L'],['Potenza','1700 W'],['Lavastoviglie','Cestello s√¨'],['Programmi','8'],['Garanzia','2 anni']], longDesc:`Abbiamo cucinato patate, pollo e verdure per pi√π giorni: la resa √® stata costante, con doratura uniforme senza odori forti. Non √® un modello ‚Äúsmart‚Äù: per molti √® un pro (meno complessit√†), per chi vuole app/appunti √® un contro. Dopo 2 settimane di uso, il rivestimento √® ancora perfetto. Consigliata a chi vuole qualit√† senza spendere troppo.`} },
  { id:"d2", title:"Cibo Secco Premium per Cani 12kg", desc:"Ricco di proteine con ingredienti dichiarati, senza coloranti. Sacco richiudibile anti-odore.", rating:4.7, reviews:1420, cat:"animali", store:"Zooplus", merchant:"awin", priceNow:39, priceWas:59, discount:34, coupon:"DOG5", image:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop", history:[59,55,49,45,39], addedAt:"2025-08-06", links:{ awin:"https://www.awin1.com/cread.php?awinmid=222&awinaffid=333" , gallery:['https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1612539927811-2b18a6c41f5e?q=80&w=1200&auto=format&fit=crop'], pros:['Buona tollerabilit√†','Rapporto qualit√†/prezzo','Sacco richiudibile comodo'], cons:['Crocche non adatte a cani molto piccoli','Nessuna variante grain-free','Odore intenso all‚Äôapertura'], specs:[['Formato','12 kg'],['Proteine','24%'],['Conservazione','Sacco richiudibile'],['Origine','UE']], longDesc:`Provato su due cani (taglia media): feci regolari e pelo lucido dopo 10 giorni. Non √® super premium, ma in promo √® un ottimo compromesso. Se il tuo cane √® sensibile ai cereali, valuta alternative grain-free.`} },
  { id:"d3", title:"Siero Viso Acido Ialuronico 60ml", desc:"Texture leggera, ad assorbimento rapido. Ingredienti essenziali, adatto a tutti i tipi di pelle.", rating:4.4, reviews:2300, cat:"bellezza", store:"Amazon", merchant:"amazon", priceNow:12, priceWas:19, discount:37, coupon:null, image:"https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop", history:[19,17,15,13,12], addedAt:"2025-08-08", links:{ amazon:"https://www.amazon.it/dp/B0AAABBBB" , gallery:['https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1545239351-1141bd82e8a6?q=80&w=1200&auto=format&fit=crop'], pros:['Texture leggera','INCI essenziale','Ottimo sotto il make-up'], cons:['Flacone senza contagocce di qualit√†','Profumo leggero non per tutti'], specs:[['Contenuto','60 ml'],['Attivo','Acido Ialuronico'],['Profumo','Leggero'],['Pelli','Tutte']], longDesc:`Usato mattina e sera per due settimane: pelle pi√π elastica, senza pilling con la crema solare. Non aspettarti miracoli anti-et√†: √® idratazione onesta a prezzo corretto.`} },
  { id:"d4", title:"Trapano Avvitatore 18V con Accessori", desc:"Coppia regolabile, luce LED e set punte incluso. Valigetta rigida per riporre tutto.", rating:4.5, reviews:980, cat:"fai_da_te", store:"Leroy Merlin", merchant:"tradedoubler", priceNow:69, priceWas:99, discount:30, coupon:null, image:"https://images.unsplash.com/photo-1504148455329-4ff0802cfb7e?q=80&w=1200&auto=format&fit=crop", history:[99,92,85,79,69], addedAt:"2025-07-30", links:{ tradedoubler:"https://clk.tradedoubler.com/click?p=333&a=444" , gallery:['https://images.unsplash.com/photo-1504148455329-4ff0802cfb7e?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1511207538754-e855bd8f15a5?q=80&w=1200&auto=format&fit=crop'], pros:['Buona coppia per lavori leggeri','Valigetta con accessori','Luce LED utile in spazi stretti'], cons:['Non adatto a muratura impegnativa','Mandrino con lieve gioco','Batteria singola in confezione base'], specs:[['Voltaggio','18 V'],['Modalit√†','Trapano/Avvitatore'],['Accessori','S√¨'],['Luce','LED']], longDesc:`Perfetto per casa: mensole, piccoli montaggi, riparazioni. Per fori importanti nel cemento serve altro. Il LED fa la differenza in armadi e nicchie.`} },
  { id:"d5", title:"Passeggino Leggero Pieghevole", desc:"Telaio in alluminio, schienale reclinabile e chiusura con una mano. Omologato fino a 15 kg.", rating:4.6, reviews:640, cat:"infanzia", store:"Amazon", merchant:"amazon", priceNow:99, priceWas:159, discount:38, coupon:"BABY10", image:"https://images.unsplash.com/photo-1631049307264-da0ec9d70304?q=80&w=1200&auto=format&fit=crop", history:[159,149,129,119,99], addedAt:"2025-08-04", links:{ amazon:"https://www.amazon.it/dp/B0CCCCCCC" , gallery:['https://images.unsplash.com/photo-1631049307264-da0ec9d70304?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1595433707802-6b2626ef1c86?q=80&w=1200&auto=format&fit=crop'], pros:['Si chiude con una mano','Molto leggero','Tessuti facili da pulire'], cons:['Cesto sottosedile non enorme','Ruote piccole su sanpietrini','Colori limitati'], specs:[['Peso','6.9 kg'],['Omologazione','fino 15 kg'],['Chiusura','One-hand'],['Accessori','Parapioggia']], longDesc:`Provato su marciapiedi e mezzi pubblici: maneggevole e stabile. Non √® un fuoristrada, ma per citt√† va benissimo. Seduta comoda, cinture rapide.`} },
  { id:"d6", title:"Set Pentole Acciaio 10 pz", desc:"Fondo adatto a induzione, manici isolanti e coperchi in vetro. Lavabile in lavastoviglie.", rating:4.5, reviews:620, cat:"casa_cucina", store:"Amazon", merchant:"amazon", priceNow:99, priceWas:149, discount:34, coupon:null, image:"https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop", history:[149,139,129,119,99], addedAt:"2025-08-01", links:{ amazon:"https://www.amazon.it/dp/B0DDDDEEEE" , gallery:['https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1485968579580-b6d095142e6e?q=80&w=1200&auto=format&fit=crop'], pros:['Fondo a sandwich per induzione','Coperchi in vetro con sfiato','Impilabili e lavabili'], cons:['Manici che scaldano a fiamma alta','Niente scala interna di misure'], specs:[['Pezzi','10'],['Materiale','Acciaio'],['Lavastoviglie','S√¨'],['Compatibilit√†','Induzione']], longDesc:`Qualit√† solida per uso quotidiano. Non antiaderenti: serve un filo d‚Äôolio in pi√π ma durano nel tempo. In promo diventano un best buy.`} },
  { id:"d7", title:"Tosaerba Elettrico 1400W", desc:"Larghezza taglio 32 cm, raccolta 30 L, regolazione altezza in 3 posizioni. Perfetto per giardini piccoli.", rating:4.2, reviews:510, cat:"fai_da_te", store:"Amazon", merchant:"amazon", priceNow:119, priceWas:179, discount:34, coupon:null, image:"https://images.unsplash.com/photo-1523419410227-deebaa99fd0f?q=80&w=1200&auto=format&fit=crop", history:[179,169,149,139,119], addedAt:"2025-07-25", links:{ amazon:"https://www.amazon.it/dp/B0FFFFGGGG" , gallery:['https://images.unsplash.com/photo-1523419410227-deebaa99fd0f?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1562599938-7208977f7baf?q=80&w=1200&auto=format&fit=crop'], pros:['Leggero e facile da spingere','Raccolta sufficiente per 200 m¬≤','Regolazione altezza rapida'], cons:['Cavo da gestire (non √® a batteria)','Rumore nella media','Scocca non metallica'], specs:[['Potenza','1400 W'],['Larghezza taglio','32 cm'],['Cesto','30 L'],['Terreno','fino 250 m¬≤']], longDesc:`Se hai un giardino piccolo/medio fa il suo, senza spese di batterie. Lame sostituibili facili da trovare. Attenzione a cavi e prolunghe di qualit√†.`} },
  { id:"d8", title:"Cuccia Morbida per Gatti L", desc:"Interno in peluche, fondo antiscivolo e cuscino estraibile. Lavabile in lavatrice 30¬∞.", rating:4.5, reviews:880, cat:"animali", store:"Amazon", merchant:"amazon", priceNow:25, priceWas:39, discount:36, coupon:null, image:"https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop", history:[39,35,32,29,25], addedAt:"2025-08-02", links:{ amazon:"https://www.amazon.it/dp/B0HHHHIIII" , gallery:['https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop','https://images.unsplash.com/photo-1573865526739-10659fec78a5?q=80&w=1200&auto=format&fit=crop'], pros:['Morbida e avvolgente','Fondo antiscivolo','Cuscino estraibile'], cons:['Taglia L stretta per gatti XXL','Colore chiaro si sporca facilmente'], specs:[['Taglia','L'],['Lavaggio','30¬∞'],['Fondo','Antiscivolo'],['Uso','Interno']], longDesc:`I gatti ci saltano dentro in pochi minuti (testato con 2 mici redattori). Calda, stabile, zero odore chimico al primo uso.`} }
]; } catch(e){ window.DEALS = []; }
    return window.DEALS;
  }
  function ensureTicker(){
    const hInner = qs('#hInner') || qs('header');
    if(!hInner) return;
    const search = hInner.querySelector('.search, form[role="search"], .searchbar, #search, input[type="search"]');
    let wrap = hInner.querySelector('#headerTicker');
    if(!wrap){ wrap = document.createElement('div'); wrap.id='headerTicker'; wrap.className='ticker-wrap'; }
    if(search && search.parentNode){
      const parent = search.parentNode;
      if(wrap.parentNode!==parent || wrap.previousElementSibling!==search){
        if(search.nextSibling) parent.insertBefore(wrap, search.nextSibling);
        else parent.appendChild(wrap);
      }
    } else {
      if(wrap.parentNode!==hInner) hInner.appendChild(wrap);
    }
    let inner = wrap.querySelector('.ticker'); if(!inner){ inner = document.createElement('div'); inner.className='ticker'; wrap.appendChild(inner); }
    let track = wrap.querySelector('.ticker-track'); if(!track){ track = document.createElement('div'); track.className='ticker-track'; inner.appendChild(track); }
    const arr = getDeals().slice(0, 20);
    const html = arr.map(o=>{
      const title = o.title || o.name || '';
      const now   = Number(o.priceNow ?? o.price ?? o.current_price ?? 0);
      const was   = Number(o.priceWas ?? o.old_price ?? 0);
      const pct   = o.discount ?? (was && now ? Math.round(100 - (now*100/was)) : 0);
      const href  = (o.links && (o.links.amazon || o.links.awin || o.links.default)) || o.url || '#';
      const price = now ? nf.format(now) : '';
      const pctTxt = pct ? ` (-${pct}%)` : '';
      return `<a class="tick" href="${href}" target="_blank" rel="nofollow sponsored">üí• <b>${title} ‚Äî ${price}${pctTxt}</b></a>`;
    }).join('');
    track.innerHTML = html || '<span class="tick"><b>Offerteshock</b> ‚Äî offerte in aggiornamento‚Ä¶</span>';
  }

  function init(){
    bindBurger();
    ensureTicker();
  }
  if (document.readyState!=='loading') init();
  else document.addEventListener('DOMContentLoaded', init);
})();
</script>
<script>
(function(){
  // Safety re-bind for burger on subpages
  var b = document.getElementById('btnBurger');
  var pop = document.getElementById('popMenu');
  var scrim = document.getElementById('popScrim');
  if(!b || !pop || !scrim) return;
  function toggle(){ 
    var open = pop.classList.toggle('open');
    scrim.style.display = open ? 'block' : 'none';
    b.setAttribute('aria-expanded', open?'true':'false');
  }
  // Remove default action just in case
  b.setAttribute('type','button');
  // Bind with capture=false to avoid interfering others
  b.addEventListener('click', function(e){ e.preventDefault(); toggle(); }, false);
  scrim.addEventListener('click', function(){ pop.classList.remove('open'); scrim.style.display='none'; b.setAttribute('aria-expanded','false'); }, false);
})();
</script>
<script>
(function(){
  if (window.__NO_RELOAD_SAME_PAGE__) return; window.__NO_RELOAD_SAME_PAGE__ = true;
  function samePath(aHref){
    try{
      const url = new URL(aHref, location.href);
      const to  = url.pathname.replace(/\/$/, '/index.html');
      const cur = location.pathname.replace(/\/$/, '/index.html');
      return (url.origin === location.origin) && (to === cur);
    }catch(e){ return false; }
  }
  document.addEventListener('click', function(e){
    const a = e.target.closest('a');
    if(!a || !a.href) return;
    if(samePath(a.href)){
      e.preventDefault();
      // Close burger if open
      const pop = document.getElementById('popMenu'); 
      const scr = document.getElementById('popScrim');
      if(pop) pop.classList.remove('open');
      if(scr) scr.style.display='none';
    }
  }, true);
})();
</script>
<script id="scroll-restore">
(function(){
  try{
    // Keep browser back/forward native restoration
    if ('scrollRestoration' in history) history.scrollRestoration = 'auto';
    function isBackForward(evt){
      if (evt && evt.persisted) return true;
      var nav = (performance.getEntriesByType && performance.getEntriesByType('navigation')) || [];
      return !!(nav[0] && nav[0].type === 'back_forward');
    }
    function toTopInstant(){
      var de = document.documentElement;
      var prev = de.style.scrollBehavior;
      de.style.scrollBehavior = 'auto';
      window.scrollTo(0,0);
      requestAnimationFrame(function(){ de.style.scrollBehavior = prev || ''; });
    }
    window.addEventListener('pageshow', function(e){
      if (isBackForward(e)) return;         // back/forward: let browser restore
      if (location.hash) return;            // anchor navigation: keep anchor
      toTopInstant();
    });
    // Fallback for older browsers
    if (document.readyState === 'complete' || document.readyState === 'interactive'){
      var nav = (performance.getEntriesByType && performance.getEntriesByType('navigation')) || [];
      if (!(nav[0] && nav[0].type === 'back_forward') && !location.hash){ toTopInstant(); }
    } else {
      document.addEventListener('DOMContentLoaded', function(){
        var nav = (performance.getEntriesByType && performance.getEntriesByType('navigation')) || [];
        if (!(nav[0] && nav[0].type === 'back_forward') && !location.hash){ toTopInstant(); }
      });
    }
  }catch(_){}
})();
</script>
</body></html>